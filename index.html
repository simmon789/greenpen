<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Trading Journal</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Sarabun', 'sans-serif'],
                    },
                    colors: {
                        pastel: {
                            bg: '#f1f8e9',      /* Very light green background */
                            card: '#ffffff',    /* White card */
                            header: '#dcedc8',  /* Light green header */
                            accent: '#8bc34a',  /* Green accent */
                            text: '#33691e',    /* Dark green text */
                            buy: '#c8e6c9',     /* Green for Buy */
                            sell: '#f8bbd0',    /* Pink for Sell */
                            done: '#cfd8dc',    /* Gray for Done */
                            
                            /* Toggle Colors */
                            toggle_off: '#000000', /* Black (Off) */
                            toggle_on: '#81d4fa'   /* Blue Pastel (On) */
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f1f8e9; /* Fallback */
            scroll-behavior: smooth;
        }
        
        /* Custom Checkbox */
        .tp-checkbox {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: #558b2f;
            cursor: pointer;
        }

        /* TP Block Styling */
        .tp-box {
            transition: all 0.3s ease;
            background-color: white; /* Ensure white background for text readability */
        }
        .tp-box.buy-mode { background-color: #c8e6c9; border-color: #a5d6a7; color: #1b5e20; }
        .tp-box.sell-mode { background-color: #f8bbd0; border-color: #f48fb1; color: #880e4f; }
        .tp-box.done-mode { background-color: #cfd8dc; border-color: #b0bec5; color: #455a64; text-decoration: line-through; }

        /* Scroll to Top Button */
        #scrollTopBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 99;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 15px;
            border-radius: 50%;
            font-size: 18px;
            transition: opacity 0.3s, transform 0.3s;
            opacity: 0;
            pointer-events: none;
        }
        #scrollTopBtn.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #scrollTopBtn:hover {
            transform: scale(1.1);
        }

        /* Confirmation Modal Styles */
        #confirmModal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 9999; /* High Z-index */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(2px);
        }

        /* Dedicated Print Area - Hidden on Screen */
        #print-output {
            display: none;
        }

        /* Print Styles - ROBUST METHOD */
        @media print {
            /* Hide the entire main body content */
            body > *:not(#print-output) {
                display: none !important;
            }

            /* Show only the print output div */
            #print-output {
                display: block !important;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                background-color: white;
                padding: 20px;
            }

            /* Ensure background colors print */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            /* Layout adjustments for print */
            #print-output .grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
        }
        
        /* Input Styles */
        input[type="number"], input[type="text"], select, textarea {
            border: 1px solid #c5e1a5;
            background-color: #ffffff;
            transition: border-color 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #7cb342;
            box-shadow: 0 0 0 3px rgba(124, 179, 66, 0.2);
        }
    </style>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyBxg46N-kB1zDyrIEAnVqlACqmmOZnu6Fg",
            authDomain: "mytradingjournal-208c5.firebaseapp.com",
            projectId: "mytradingjournal-208c5",
            storageBucket: "mytradingjournal-208c5.firebasestorage.app",
            messagingSenderId: "692684967717",
            appId: "1:692684967717:web:1cac3a8877ae65c49554cc",
            measurementId: "G-JKF602BZDS"
        };

        // --- Variables ---
        let db, dataDocRef;
        const publicDocPath = "/publicJournal/sharedData";

        // --- Init ---
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                db = getFirestore(app);
                await signInAnonymously(auth);
                
                dataDocRef = doc(db, publicDocPath);
                
                // Realtime Listener
                onSnapshot(dataDocRef, (docSnap) => {
                    if (docSnap.exists()) {
                        loadDataToUI(docSnap.data());
                        document.getElementById('status-indicator').innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß (Sync)";
                        document.getElementById('status-indicator').className = "text-sm text-green-700 font-medium";
                    }
                });

                setupEventListeners();
                
            } catch (e) {
                console.error("Firebase Error:", e);
                document.getElementById('status-indicator').innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ";
                document.getElementById('status-indicator').className = "text-sm text-red-600 font-medium";
            }
        });

        // --- Data Handling ---
        const fields = [
            'date', 'dr-price', 
            // MN - Setup 1
            'mn-sig', 'mn-wick', 'mn-tp1-check', 'mn-tp2-check', 'mn-low', 'mn-high',
            // MN - Setup 2
            'mn-toggle-2', 'mn-sig-2', 'mn-wick-2', 'mn-tp1-check-2', 'mn-tp2-check-2',
            
            // WK - Setup 1
            'wk-sig', 'wk-wick', 'wk-tp1-check', 'wk-tp2-check', 'wk-low', 'wk-high',
            // WK - Setup 2
            'wk-toggle-2', 'wk-sig-2', 'wk-wick-2', 'wk-tp1-check-2', 'wk-tp2-check-2',

            // D - Setup 1
            'd-sig', 'd-wick', 'd-tp1-check', 'd-tp2-check', 'd-low', 'd-high',
            // D - Setup 2
            'd-toggle-2', 'd-sig-2', 'd-wick-2', 'd-tp1-check-2', 'd-tp2-check-2',

            // H4 - Setup 1
            'h4-sig', 'h4-wick', 'h4-tp1-check', 'h4-tp2-check', 'h4-low', 'h4-high',
            // H4 - Setup 2
            'h4-toggle-2', 'h4-sig-2', 'h4-wick-2', 'h4-tp1-check-2', 'h4-tp2-check-2',

            // H1 - Setup 1 (Modified: No TP2, No Setup 2)
            'h1-sig', 'h1-wick', 'h1-tp1-check', 'h1-low', 'h1-high',
            
            // Note
            'daily-note'
        ];

        function loadDataToUI(data) {
            fields.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                if (el.type === 'checkbox') el.checked = data[id] || false;
                else el.value = data[id] || '';
            });
            recalcAll();
        }

        async function saveData() {
            if (!dataDocRef) return;
            const data = {};
            fields.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                data[id] = el.type === 'checkbox' ? el.checked : el.value;
            });
            await setDoc(dataDocRef, data);
        }

        // --- Logic & Calculations ---
        
        function recalcAll() {
            // Daily Frame
            const drPrice = parseFloat(document.getElementById('dr-price').value) || 0;
            if (drPrice) {
                document.getElementById('dr-res').innerText = (drPrice + 5).toFixed(2);
                document.getElementById('dr-sup').innerText = (drPrice - 5).toFixed(2);
            } else {
                document.getElementById('dr-res').innerText = "...";
                document.getElementById('dr-sup').innerText = "...";
            }

            // Main Timeframes
            processTimeframe('mn', 500, 1000);
            processTimeframe('wk', 150, 300);
            processTimeframe('d', 50, 100);
            processTimeframe('h4', 15, 30);
            
            // H1 Special Case (No TP2, No Setup 2)
            processTimeframe('h1', 10, null); // null indicates no TP2

            updateSummary();
        }

        function processTimeframe(prefix, tp1Diff, tp2Diff) {
            // Calc Setup 1
            calcTF(prefix, '', tp1Diff, tp2Diff);
            
            // Check Toggle for Setup 2
            const toggle = document.getElementById(`${prefix}-toggle-2`);
            const container2 = document.getElementById(`${prefix}-setup-2`);
            
            if (toggle) {
                if (toggle.checked) {
                    if(container2) container2.classList.remove('hidden');
                    calcTF(prefix, '-2', tp1Diff, tp2Diff); // Calc Setup 2
                } else {
                    if(container2) container2.classList.add('hidden');
                }
            }
        }

        function calcTF(prefix, suffix, tp1Diff, tp2Diff) {
            const sigId = `${prefix}-sig${suffix}`;
            const wickId = `${prefix}-wick${suffix}`;
            const tp1CheckId = `${prefix}-tp1-check${suffix}`;
            const tp2CheckId = `${prefix}-tp2-check${suffix}`;
            
            const sigEl = document.getElementById(sigId);
            const wickEl = document.getElementById(wickId);
            
            // UI Targets
            const tp1El = document.getElementById(`${prefix}-tp1-val${suffix}`);
            const tp2El = document.getElementById(`${prefix}-tp2-val${suffix}`);
            const box1 = document.getElementById(`${prefix}-tp1-box${suffix}`);
            const box2 = document.getElementById(`${prefix}-tp2-box${suffix}`);
            const msgEl = document.getElementById(`${prefix}-msg${suffix}`);

            if (!sigEl || !wickEl) return;

            const sig = sigEl.value;
            const wickInput = wickEl.value;
            const wick = parseFloat(wickInput);
            const tp1Check = document.getElementById(tp1CheckId).checked;
            
            // TP2 might not exist (H1 case)
            const tp2CheckEl = document.getElementById(tp2CheckId);
            const tp2Check = tp2CheckEl ? tp2CheckEl.checked : false;

            let tp1Val = 0, tp2Val = 0;

            // Reset Styles
            if(box1) box1.className = "tp-box border rounded p-2 flex items-center justify-between";
            if(box2) box2.className = "tp-box border rounded p-2 flex items-center justify-between mt-2";
            msgEl.innerText = ""; // Also clears innerHTML

            if (!sig) {
                if(tp1El) tp1El.innerText = "...";
                if(tp2El) tp2El.innerText = "...";
                return; 
            }

            if (isNaN(wick) || wickInput === "") {
                if(tp1El) tp1El.innerText = "...";
                if(tp2El) tp2El.innerText = "...";
                msgEl.innerText = "**‡∏£‡∏≠‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig**";
                msgEl.className = "text-sm text-red-500 font-bold mt-2";
                return;
            }

            if (sig.includes("Buy")) {
                tp1Val = wick + tp1Diff;
                if(tp2Diff !== null) tp2Val = wick + tp2Diff;
                
                if(box1) {
                    if (!tp1Check) box1.classList.add("buy-mode");
                }
                if(box2 && tp2Diff !== null) {
                    if (!tp2Check) box2.classList.add("buy-mode");
                }
            } else if (sig.includes("Sell")) {
                tp1Val = wick - tp1Diff;
                if(tp2Diff !== null) tp2Val = wick - tp2Diff;
                
                if(box1) {
                    if (!tp1Check) box1.classList.add("sell-mode");
                }
                if(box2 && tp2Diff !== null) {
                    if (!tp2Check) box2.classList.add("sell-mode");
                }
            }
            
            if(tp1El) tp1El.innerText = tp1Val.toFixed(2);
            if(tp2El && tp2Diff !== null) tp2El.innerText = tp2Val.toFixed(2);

            const tfName = prefix.toUpperCase();
            const setupName = suffix ? " (Setup 2)" : "";
            
            // Logic for Status Message
            if (tp2Diff === null) {
                // Single TP Mode (H1)
                if (tp1Check) {
                    msgEl.innerHTML = `‡∏Ñ‡∏£‡∏ö TP1 (‡∏à‡∏ö‡∏á‡∏≤‡∏ô) ${tfName} ‚úÖ‚úÖ<br>‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${wick.toFixed(2)}`;
                    msgEl.className = "text-sm text-green-700 font-bold mt-2";
                }
            } else {
                // Dual TP Mode
                if (tp1Check && !tp2Check) {
                    msgEl.innerHTML = `‡∏Ñ‡∏£‡∏ö TP1 ${tfName}${setupName} ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏µ‡πà ${tp1Val.toFixed(2)} ‚úÖ ‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏î TP2 ‡∏ó‡∏µ‡πà ${tp2Val.toFixed(2)}<br>‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${wick.toFixed(2)}`;
                    msgEl.className = "text-sm text-orange-600 font-semibold mt-2";
                } else if (tp1Check && tp2Check) {
                    msgEl.innerHTML = `‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á 2 TP ${tfName}${setupName} ‚úÖ‚úÖ`;
                    msgEl.className = "text-sm text-green-700 font-bold mt-2";
                }
            }

            if (tp1Check && box1) box1.classList.add("done-mode");
            if (tp2Check && box2) box2.classList.add("done-mode");
        }

        async function clearSection(prefix) {
            // Find fields starting with prefix
            fields.forEach(key => {
                if (key.startsWith(prefix + '-')) {
                    const el = document.getElementById(key);
                    if(el) {
                        if(el.type === 'checkbox') el.checked = false;
                        else el.value = '';
                    }
                }
            });
            
            recalcAll();
            await saveData();
            
            const statusEl = document.getElementById('status-indicator');
            statusEl.innerText = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${prefix.toUpperCase()} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`;
            statusEl.className = "text-sm text-blue-600 font-medium";
            setTimeout(() => {
                 statusEl.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß (Sync)";
                 statusEl.className = "text-sm text-green-700 font-medium";
            }, 1500);
        }

        window.clearSection = clearSection;
        window.saveData = saveData;
        window.setDate = () => {
            const d = new Date();
            const dateStr = d.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('date').value = dateStr;
            saveData();
        };

        window.openClearAllModal = () => {
            const modal = document.getElementById('confirmModal');
            modal.style.display = 'flex';
        };

        window.closeModal = () => {
            const modal = document.getElementById('confirmModal');
            modal.style.display = 'none';
        };

        window.confirmClearAll = async () => {
            window.closeModal();
            fields.forEach(key => {
                const el = document.getElementById(key);
                if(el) {
                    if(el.type === 'checkbox') el.checked = false;
                    else el.value = '';
                }
            });
            recalcAll();
            await saveData();
            
            const statusEl = document.getElementById('status-indicator');
            statusEl.innerText = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`;
            statusEl.className = "text-sm text-red-600 font-medium";
            setTimeout(() => {
                 statusEl.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß (Sync)";
                 statusEl.className = "text-sm text-green-700 font-medium";
            }, 2000);
        };
        
        window.printSummary = () => {
            updateSummary();
            let summaryHTML = document.getElementById('summary-content').innerHTML;
            summaryHTML = summaryHTML.replace(/bg-white/g, 'bg-pastel-bg');

            const noteContent = document.getElementById('daily-note').value;
            const printArea = document.getElementById('print-output');
            let printHTML = `
                <h1 class="text-2xl font-bold text-center mb-4 text-pastel-text">Trading Journal Summary</h1>
                <p class="text-center mb-6 text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${document.getElementById('date').value || '-'}</p>
                ${summaryHTML}
            `;
            
            if(noteContent) {
                printHTML += `
                <div class="mt-6 border-t pt-4">
                    <h4 class="font-bold text-lg mb-2 text-pastel-text">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                    <div class="p-3 border rounded text-sm text-gray-800 whitespace-pre-wrap bg-pastel-bg">${noteContent}</div>
                </div>`;
            }
            printArea.innerHTML = printHTML;
            setTimeout(() => {
                window.print();
            }, 300);
        };
        
        window.scrollToTop = () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.onscroll = function() {
            const btn = document.getElementById("scrollTopBtn");
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                btn.classList.add("visible");
            } else {
                btn.classList.remove("visible");
            }
        };

        function setupEventListeners() {
            fields.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('change', () => { recalcAll(); saveData(); });
                    el.addEventListener('input', () => { recalcAll(); }); 
                }
            });
        }

        function getTrendIcon(sig) {
            if (!sig) return '<span class="text-gray-300">-</span>';
            if (sig.includes("Buy")) return '<span class="text-green-600 font-bold">‚ñ≤ BUY</span>';
            if (sig.includes("Sell")) return '<span class="text-rose-600 font-bold">‚ñº SELL</span>';
            return '-';
        }

        function getStatusBadge(htmlContent) {
            if (htmlContent.includes("‚úÖ‚úÖ")) return '<span class="px-2 py-1 text-xs font-bold text-white bg-green-500 rounded-full shadow">Complete</span>';
            if (htmlContent.includes("‚úÖ")) return '<span class="px-2 py-1 text-xs font-bold text-white bg-orange-400 rounded-full shadow">TP1 Hit</span>';
            if (htmlContent.includes("‡∏£‡∏≠‡πÑ‡∏™‡πâ")) return '<span class="px-2 py-1 text-xs font-bold text-gray-500 bg-gray-200 rounded-full">Waiting</span>';
            return '<span class="px-2 py-1 text-xs font-bold text-blue-500 bg-blue-100 rounded-full">Active</span>';
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summary-content');
            if(!summaryDiv) return;

            let buyCount = 0;
            let sellCount = 0;
            const timeframes = ['mn', 'wk', 'd', 'h4', 'h1'];
            
            timeframes.forEach(tf => {
                const s1 = document.getElementById(`${tf}-sig`).value;
                // Safe access for Setup 2 elements (H1 might not have them)
                const toggleEl = document.getElementById(`${tf}-toggle-2`);
                const s2El = document.getElementById(`${tf}-sig-2`);
                
                const toggle2 = toggleEl ? toggleEl.checked : false;
                const s2 = s2El ? s2El.value : "";

                if(s1.includes("Buy")) buyCount++;
                if(s1.includes("Sell")) sellCount++;
                if(toggle2 && s2.includes("Buy")) buyCount++;
                if(toggle2 && s2.includes("Sell")) sellCount++;
            });

            let sentimentHTML = '';
            if(buyCount > sellCount) {
                sentimentHTML = `<div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded shadow-sm flex justify-between items-center">
                    <div>
                        <p class="font-bold text-lg">üêÇ Bullish Sentiment (‡∏°‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô)</p>
                        <p class="text-sm">‡πÅ‡∏£‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÉ‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (${buyCount} vs ${sellCount})</p>
                    </div>
                    <div class="text-3xl">üöÄ</div>
                </div>`;
            } else if(sellCount > buyCount) {
                sentimentHTML = `<div class="bg-rose-100 border-l-4 border-rose-500 text-rose-700 p-4 mb-6 rounded shadow-sm flex justify-between items-center">
                    <div>
                        <p class="font-bold text-lg">üêª Bearish Sentiment (‡∏°‡∏≠‡∏á‡∏•‡∏á)</p>
                        <p class="text-sm">‡πÅ‡∏£‡∏á‡∏Ç‡∏≤‡∏¢‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÉ‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (${sellCount} vs ${buyCount})</p>
                    </div>
                    <div class="text-3xl">ü©∏</div>
                </div>`;
            } else if (buyCount === 0 && sellCount === 0) {
                 sentimentHTML = `<div class="bg-gray-100 border-l-4 border-gray-400 text-gray-600 p-4 mb-6 rounded shadow-sm">
                    <p class="font-bold">Waiting for Setup...</p>
                </div>`;
            } else {
                sentimentHTML = `<div class="bg-yellow-50 border-l-4 border-yellow-400 text-yellow-700 p-4 mb-6 rounded shadow-sm flex justify-between items-center">
                    <div>
                        <p class="font-bold text-lg">‚öñÔ∏è Mixed Sentiment (‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô)</p>
                        <p class="text-sm">‡πÅ‡∏£‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏¢‡∏û‡∏≠‡πÜ ‡∏Å‡∏±‡∏ô (${buyCount} vs ${sellCount}) ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏™‡∏ß‡∏¥‡∏á</p>
                    </div>
                    <div class="text-3xl">‚ö†Ô∏è</div>
                </div>`;
            }

            const drPrice = document.getElementById('dr-price').value || '-';
            const drRes = document.getElementById('dr-res').innerText;
            const drSup = document.getElementById('dr-sup').innerText;
            
            let html = sentimentHTML;

            html += `
            <div class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div class="bg-gradient-to-br from-red-50 to-white p-4 rounded-xl shadow border border-red-100">
                    <p class="text-xs text-red-500 font-bold uppercase tracking-wider">Resistance (‡∏ï‡πâ‡∏≤‡∏ô)</p>
                    <p class="text-2xl font-bold text-gray-800 mt-1">${drRes}</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow border border-gray-200 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-blue-400"></div>
                    <p class="text-xs text-gray-500 font-bold uppercase tracking-wider">Open Price</p>
                    <p class="text-2xl font-bold text-blue-600 mt-1">${drPrice}</p>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-white p-4 rounded-xl shadow border border-green-100">
                    <p class="text-xs text-green-500 font-bold uppercase tracking-wider">Support (‡∏£‡∏±‡∏ö)</p>
                    <p class="text-2xl font-bold text-gray-800 mt-1">${drSup}</p>
                </div>
            </div>`;

            html += `<div class="grid grid-cols-1 md:grid-cols-5 gap-3">`;

            timeframes.forEach(tf => {
                const sig1 = document.getElementById(`${tf}-sig`).value;
                const wick1 = document.getElementById(`${tf}-wick`).value;
                const tp1_1 = document.getElementById(`${tf}-tp1-val`).innerText;
                
                // Safe access for TP2 (H1 doesn't have it)
                const tp2El = document.getElementById(`${tf}-tp2-val`);
                const tp2_1 = tp2El ? tp2El.innerText : null;
                
                const msg1 = document.getElementById(`${tf}-msg`).innerHTML;

                // Safe access for Setup 2
                const toggleEl = document.getElementById(`${tf}-toggle-2`);
                const toggle2 = toggleEl ? toggleEl.checked : false;
                
                let sig2 = "", wick2 = "", tp1_2 = "", tp2_2 = "", msg2 = "";
                if(toggle2) {
                    sig2 = document.getElementById(`${tf}-sig-2`).value;
                    wick2 = document.getElementById(`${tf}-wick-2`).value;
                    tp1_2 = document.getElementById(`${tf}-tp1-val-2`).innerText;
                    tp2_2 = document.getElementById(`${tf}-tp2-val-2`).innerText;
                    msg2 = document.getElementById(`${tf}-msg-2`).innerHTML;
                }

                const low = document.getElementById(`${tf}-low`).value;
                const high = document.getElementById(`${tf}-high`).value;

                let headerColor = "bg-gray-100 text-gray-700";
                if(tf === 'mn') headerColor = "bg-indigo-100 text-indigo-800";
                if(tf === 'wk') headerColor = "bg-purple-100 text-purple-800";
                if(tf === 'd') headerColor = "bg-emerald-100 text-emerald-800";
                if(tf === 'h4') headerColor = "bg-amber-100 text-amber-800";
                if(tf === 'h1') headerColor = "bg-rose-100 text-rose-800";

                if (sig1 || wick1 || (toggle2 && (sig2 || wick2)) || low || high) {
                    html += `
                    <div class="bg-white rounded-lg border border-gray-200 shadow-sm flex flex-col hover:shadow-md transition-shadow break-inside-avoid">
                        <div class="${headerColor} px-3 py-2 rounded-t-lg border-b border-gray-200 flex justify-between items-center">
                            <span class="font-bold text-sm uppercase">${tf}</span>
                            ${(low && high) ? '<span class="text-[10px] bg-white/50 px-1 rounded">SW Mode</span>' : ''}
                        </div>

                        <div class="p-3 text-sm flex-1 flex flex-col gap-3">
                            <div class="relative">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="font-bold text-gray-400 text-[10px]">S1</span>
                                    ${getStatusBadge(msg1)}
                                </div>
                                <div class="text-center py-1">
                                    ${getTrendIcon(sig1)}
                                    ${wick1 ? `
                                        <div class="text-gray-800 font-mono font-bold text-lg mt-1">${wick1}</div>
                                        <div class="mt-1 text-xs text-green-600 bg-green-50 rounded px-1 inline-block border border-green-100">
                                            ‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≠‡∏ö: <span class="font-bold text-green-700">${wick1}</span>
                                        </div>
                                    ` : ''}
                                </div>
                                ${(sig1 && wick1) ? `
                                <div class="flex justify-between text-[10px] text-gray-500 border-t pt-1 mt-1">
                                    <span>TP1: <b class="text-gray-700">${tp1_1}</b></span>
                                    ${tp2_1 ? `<span>TP2: <b class="text-gray-700">${tp2_1}</b></span>` : ''}
                                </div>` : ''}
                            </div>

                            ${(toggle2 && sig2) ? `
                            <div class="relative border-t border-dashed pt-2">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="font-bold text-gray-400 text-[10px]">S2</span>
                                    ${getStatusBadge(msg2)}
                                </div>
                                <div class="text-center py-1">
                                    ${getTrendIcon(sig2)}
                                    ${wick2 ? `
                                        <div class="text-gray-800 font-mono font-bold text-lg mt-1">${wick2}</div>
                                        <div class="mt-1 text-xs text-green-600 bg-green-50 rounded px-1 inline-block border border-green-100">
                                            ‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≠‡∏ö: <span class="font-bold text-green-700">${wick2}</span>
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="flex justify-between text-[10px] text-gray-500 border-t pt-1 mt-1">
                                    <span>TP1: <b class="text-gray-700">${tp1_2}</b></span>
                                    <span>TP2: <b class="text-gray-700">${tp2_2}</b></span>
                                </div>
                            </div>
                            ` : ''}

                            ${(low || high) ? `
                            <div class="mt-auto bg-gray-50 rounded p-2 border border-gray-100">
                                <div class="flex justify-between text-[10px] text-gray-500 mb-1">
                                    <span>High</span>
                                    <span class="font-mono text-gray-700">${high || '-'}</span>
                                </div>
                                <div class="w-full h-1 bg-gray-200 rounded-full mb-1"></div>
                                <div class="flex justify-between text-[10px] text-gray-500">
                                    <span>Low</span>
                                    <span class="font-mono text-gray-700">${low || '-'}</span>
                                </div>
                            </div>
                            ` : ''}

                        </div>
                    </div>`;
                } else {
                    html += `
                    <div class="bg-gray-50 rounded-lg border border-gray-100 flex items-center justify-center p-4 min-h-[150px] opacity-50">
                        <div class="text-center">
                            <span class="block text-gray-300 font-bold uppercase text-lg">${tf}</span>
                            <span class="text-xs text-gray-400">No Data</span>
                        </div>
                    </div>`;
                }
            });

            html += `</div>`; 
            
            summaryDiv.innerHTML = html;
        }

    </script>
</head>
<body class="text-gray-700">

    <!-- Scroll To Top Button -->
    <button id="scrollTopBtn" onclick="scrollToTop()" class="bg-pastel-accent text-white shadow-lg hover:bg-green-600 no-print" title="‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>

    <!-- Confirmation Modal (Direct Style Manipulation) -->
    <div id="confirmModal" onclick="if(event.target === this) closeModal()">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4 border-2 border-red-200">
            <h3 class="text-xl font-bold text-red-600 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            <p class="text-gray-600 mb-6">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Journal ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? <br><span class="text-xs text-red-500">*‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ</span></p>
            <div class="flex justify-end gap-3">
                <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="confirmClearAll()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>
    </div>

    <!-- Dedicated Print Output Container (Hidden on Screen) -->
    <div id="print-output"></div>

    <div class="print-container max-w-4xl mx-auto p-4 md:p-6 bg-white shadow-lg min-h-screen my-4 rounded-xl border border-pastel-header">
        
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-6 pb-4 border-b border-pastel-header no-print">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-pastel-text">Trading Journal</h1>
                <p class="text-sm text-gray-500" id="status-indicator">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</p>
            </div>
            <div class="mt-4 md:mt-0 flex gap-2 flex-wrap justify-center">
                <button onclick="saveData()" class="px-4 py-2 bg-pastel-accent text-white font-bold rounded-lg shadow hover:bg-green-600 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Cloud</button>
                <button onclick="printSummary()" class="px-4 py-2 bg-purple-500 text-white font-bold rounded-lg shadow hover:bg-purple-600 transition">‡∏û‡∏¥‡∏°‡∏û‡πå(‡∏™‡∏£‡∏∏‡∏õ) PDF</button>
                <button onclick="openClearAllModal()" class="px-4 py-2 bg-red-500 text-white font-bold rounded-lg shadow hover:bg-red-600 transition">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
        </header>

        <!-- Main Form -->
        <div class="main-form-section space-y-8">
            
            <!-- Daily Plan -->
            <section class="bg-pastel-bg p-4 rounded-xl border border-pastel-header">
                <h2 class="text-xl font-bold text-pastel-text mb-4">‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h2>
                <div class="flex flex-col md:flex-row gap-4 items-end mb-4">
                    <div class="w-full md:w-auto flex-1">
                        <label class="block text-sm font-semibold mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <div class="flex gap-2">
                            <input type="text" id="date" class="w-full p-2 rounded" placeholder="‡∏ß‡∏ß/‡∏î‡∏î/‡∏õ‡∏õ‡∏õ‡∏õ">
                            <button onclick="setDate()" class="px-3 py-2 bg-blue-500 text-white rounded shadow text-sm whitespace-nowrap">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-semibold mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡∏ß‡∏±‡∏ô (07.00 ‡∏ô.)</label>
                        <input type="number" step="0.01" id="dr-price" class="w-full p-2 rounded" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤">
                    </div>
                    <div class="bg-white p-2 rounded border border-gray-200">
                        <span class="block text-xs text-gray-500">‡πÅ‡∏ô‡∏ß‡∏ï‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å (+5)</span>
                        <span id="dr-res" class="text-lg font-bold text-red-500">...</span>
                    </div>
                    <div class="bg-white p-2 rounded border border-gray-200">
                        <span class="block text-xs text-gray-500">‡πÅ‡∏ô‡∏ß‡∏ï‡πâ‡∏≤‡∏ô‡∏£‡∏±‡∏ö (-5)</span>
                        <span id="dr-sup" class="text-lg font-bold text-green-500">...</span>
                    </div>
                </div>
            </section>

            <!-- Main Timeframes Analysis -->
            <section class="space-y-6">
                <h2 class="text-2xl font-bold text-pastel-text border-l-4 border-pastel-accent pl-3">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏£‡∏≤‡∏ü‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h2>

                <!-- Template for TF Block -->
                <!-- MONTH -->
                <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-200 shadow-sm relative">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-pastel-text">MONTH (MN)</h3>
                        <div class="flex gap-3 items-center">
                            <label class="flex items-center cursor-pointer text-sm select-none">
                                <span class="mr-2 font-medium text-gray-600">Setup 2</span>
                                <div class="relative">
                                    <input type="checkbox" id="mn-toggle-2" class="sr-only peer">
                                    <div class="w-9 h-5 bg-pastel-toggle_off peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-pastel-toggle_on"></div>
                                </div>
                            </label>
                            <button onclick="clearSection('mn')" class="text-xs text-red-500 hover:text-red-700 underline">CLEAR MN</button>
                        </div>
                    </div>
                    
                    <!-- Setup 1 -->
                    <div id="mn-setup-1">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">Sig Buy/Sell</label>
                                <select id="mn-sig" class="w-full p-2 rounded">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>
                                    <option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option>
                                    <option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig MN</label>
                                <input type="number" step="0.01" id="mn-wick" class="w-full p-2 rounded" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
                            </div>
                            <div class="col-span-1 md:col-span-2 grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Sideway Low</label>
                                    <input type="number" step="0.01" id="mn-low" class="w-full p-2 rounded">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Sideway High</label>
                                    <input type="number" step="0.01" id="mn-high" class="w-full p-2 rounded">
                                </div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div id="mn-tp1-box" class="tp-box border rounded p-2 flex items-center justify-between">
                                <span class="font-semibold text-sm">TP1 MN (+/- 500) : <span id="mn-tp1-val">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="mn-tp1-check">TP</label>
                                    <input type="checkbox" id="mn-tp1-check" class="tp-checkbox">
                                </div>
                            </div>
                            <div id="mn-tp2-box" class="tp-box border rounded p-2 flex items-center justify-between mt-2">
                                <span class="font-semibold text-sm">TP2 MN (+/- 1000) : <span id="mn-tp2-val">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="mn-tp2-check">TP</label>
                                    <input type="checkbox" id="mn-tp2-check" class="tp-checkbox">
                                </div>
                            </div>
                        </div>
                        <div id="mn-msg" class="min-h-[1.5rem]"></div>
                    </div>

                    <!-- Setup 2 -->
                    <div id="mn-setup-2" class="hidden mt-4 pt-4 border-t-2 border-dashed border-indigo-200">
                        <h4 class="text-sm font-bold text-gray-500 mb-3 bg-white inline-block px-2 py-1 rounded">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà 2 (Setup 2)</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">Sig Buy/Sell (2)</label>
                                <select id="mn-sig-2" class="w-full p-2 rounded">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>
                                    <option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option>
                                    <option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig (2)</label>
                                <input type="number" step="0.01" id="mn-wick-2" class="w-full p-2 rounded" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div id="mn-tp1-box-2" class="tp-box border rounded p-2 flex items-center justify-between">
                                <span class="font-semibold text-sm">TP1 (+/- 500) : <span id="mn-tp1-val-2">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="mn-tp1-check-2">TP</label>
                                    <input type="checkbox" id="mn-tp1-check-2" class="tp-checkbox">
                                </div>
                            </div>
                            <div id="mn-tp2-box-2" class="tp-box border rounded p-2 flex items-center justify-between mt-2">
                                <span class="font-semibold text-sm">TP2 (+/- 1000) : <span id="mn-tp2-val-2">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="mn-tp2-check-2">TP</label>
                                    <input type="checkbox" id="mn-tp2-check-2" class="tp-checkbox">
                                </div>
                            </div>
                        </div>
                        <div id="mn-msg-2" class="min-h-[1.5rem]"></div>
                    </div>
                </div>

                <!-- WEEK -->
                <div class="bg-purple-50 p-4 rounded-xl border border-purple-200 shadow-sm relative">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-pastel-text">WEEK (WK)</h3>
                        <div class="flex gap-3 items-center">
                            <label class="flex items-center cursor-pointer text-sm select-none">
                                <span class="mr-2 font-medium text-gray-600">Setup 2</span>
                                <div class="relative">
                                    <input type="checkbox" id="wk-toggle-2" class="sr-only peer">
                                    <div class="w-9 h-5 bg-pastel-toggle_off peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-pastel-toggle_on"></div>
                                </div>
                            </label>
                            <button onclick="clearSection('wk')" class="text-xs text-red-500 hover:text-red-700 underline">CLEAR WK</button>
                        </div>
                    </div>

                    <!-- Setup 1 -->
                    <div id="wk-setup-1">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">Sig Buy/Sell</label>
                                <select id="wk-sig" class="w-full p-2 rounded">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>
                                    <option value="Buy P1">Buy P1</option>
                                    <option value="Buy P2">Buy P2</option>
                                    <option value="Buy P3">Buy P3</option>
                                    <option value="Sell P1">Sell P1</option>
                                    <option value="Sell P2">Sell P2</option>
                                    <option value="Sell P3">Sell P3</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig WK</label>
                                <input type="number" step="0.01" id="wk-wick" class="w-full p-2 rounded" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
                            </div>
                            <div class="col-span-1 md:col-span-2 grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Sideway Low</label>
                                    <input type="number" step="0.01" id="wk-low" class="w-full p-2 rounded">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Sideway High</label>
                                    <input type="number" step="0.01" id="wk-high" class="w-full p-2 rounded">
                                </div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div id="wk-tp1-box" class="tp-box border rounded p-2 flex items-center justify-between">
                                <span class="font-semibold text-sm">TP1 WK (+/- 150) : <span id="wk-tp1-val">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="wk-tp1-check">TP</label>
                                    <input type="checkbox" id="wk-tp1-check" class="tp-checkbox">
                                </div>
                            </div>
                            <div id="wk-tp2-box" class="tp-box border rounded p-2 flex items-center justify-between mt-2">
                                <span class="font-semibold text-sm">TP2 WK (+/- 300) : <span id="wk-tp2-val">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="wk-tp2-check">TP</label>
                                    <input type="checkbox" id="wk-tp2-check" class="tp-checkbox">
                                </div>
                            </div>
                        </div>
                        <div id="wk-msg" class="min-h-[1.5rem]"></div>
                    </div>

                    <!-- Setup 2 -->
                    <div id="wk-setup-2" class="hidden mt-4 pt-4 border-t-2 border-dashed border-purple-200">
                        <h4 class="text-sm font-bold text-gray-500 mb-3 bg-white inline-block px-2 py-1 rounded">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà 2 (Setup 2)</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">Sig Buy/Sell (2)</label>
                                <select id="wk-sig-2" class="w-full p-2 rounded">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>
                                    <option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option>
                                    <option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig (2)</label>
                                <input type="number" step="0.01" id="wk-wick-2" class="w-full p-2 rounded" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div id="wk-tp1-box-2" class="tp-box border rounded p-2 flex items-center justify-between">
                                <span class="font-semibold text-sm">TP1 (+/- 150) : <span id="wk-tp1-val-2">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="wk-tp1-check-2">TP</label>
                                    <input type="checkbox" id="wk-tp1-check-2" class="tp-checkbox">
                                </div>
                            </div>
                            <div id="wk-tp2-box-2" class="tp-box border rounded p-2 flex items-center justify-between mt-2">
                                <span class="font-semibold text-sm">TP2 (+/- 300) : <span id="wk-tp2-val-2">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="wk-tp2-check-2">TP</label>
                                    <input type="checkbox" id="wk-tp2-check-2" class="tp-checkbox">
                                </div>
                            </div>
                        </div>
                        <div id="wk-msg-2" class="min-h-[1.5rem]"></div>
                    </div>
                </div>

                <!-- DAY -->
                <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-200 shadow-sm relative">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-pastel-text">DAY (D)</h3>
                        <div class="flex gap-3 items-center">
                            <label class="flex items-center cursor-pointer text-sm select-none">
                                <span class="mr-2 font-medium text-gray-600">Setup 2</span>
                                <div class="relative">
                                    <input type="checkbox" id="d-toggle-2" class="sr-only peer">
                                    <div class="w-9 h-5 bg-pastel-toggle_off peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-pastel-toggle_on"></div>
                                </div>
                            </label>
                            <button onclick="clearSection('d')" class="text-xs text-red-500 hover:text-red-700 underline">CLEAR DAY</button>
                        </div>
                    </div>

                    <!-- Setup 1 -->
                    <div id="d-setup-1">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">Sig Buy/Sell</label>
                                <select id="d-sig" class="w-full p-2 rounded">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>
                                    <option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option>
                                    <option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig Day</label>
                                <input type="number" step="0.01" id="d-wick" class="w-full p-2 rounded" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
                            </div>
                            <div class="col-span-1 md:col-span-2 grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Sideway Low</label>
                                    <input type="number" step="0.01" id="d-low" class="w-full p-2 rounded">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Sideway High</label>
                                    <input type="number" step="0.01" id="d-high" class="w-full p-2 rounded">
                                </div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div id="d-tp1-box" class="tp-box border rounded p-2 flex items-center justify-between">
                                <span class="font-semibold text-sm">TP1 Day (+/- 50) : <span id="d-tp1-val">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="d-tp1-check">TP</label>
                                    <input type="checkbox" id="d-tp1-check" class="tp-checkbox">
                                </div>
                            </div>
                            <div id="d-tp2-box" class="tp-box border rounded p-2 flex items-center justify-between mt-2">
                                <span class="font-semibold text-sm">TP2 Day (+/- 100) : <span id="d-tp2-val">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="d-tp2-check">TP</label>
                                    <input type="checkbox" id="d-tp2-check" class="tp-checkbox">
                                </div>
                            </div>
                        </div>
                        <div id="d-msg" class="min-h-[1.5rem]"></div>
                    </div>

                    <!-- Setup 2 -->
                    <div id="d-setup-2" class="hidden mt-4 pt-4 border-t-2 border-dashed border-emerald-200">
                        <h4 class="text-sm font-bold text-gray-500 mb-3 bg-white inline-block px-2 py-1 rounded">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà 2 (Setup 2)</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">Sig Buy/Sell (2)</label>
                                <select id="d-sig-2" class="w-full p-2 rounded">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>
                                    <option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option>
                                    <option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig (2)</label>
                                <input type="number" step="0.01" id="d-wick-2" class="w-full p-2 rounded" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div id="d-tp1-box-2" class="tp-box border rounded p-2 flex items-center justify-between">
                                <span class="font-semibold text-sm">TP1 (+/- 50) : <span id="d-tp1-val-2">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="d-tp1-check-2">TP</label>
                                    <input type="checkbox" id="d-tp1-check-2" class="tp-checkbox">
                                </div>
                            </div>
                            <div id="d-tp2-box-2" class="tp-box border rounded p-2 flex items-center justify-between mt-2">
                                <span class="font-semibold text-sm">TP2 (+/- 100) : <span id="d-tp2-val-2">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="d-tp2-check-2">TP</label>
                                    <input type="checkbox" id="d-tp2-check-2" class="tp-checkbox">
                                </div>
                            </div>
                        </div>
                        <div id="d-msg-2" class="min-h-[1.5rem]"></div>
                    </div>
                </div>

                <!-- H4 -->
                <div class="bg-amber-50 p-4 rounded-xl border border-amber-200 shadow-sm relative">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-pastel-text">H4</h3>
                        <div class="flex gap-3 items-center">
                            <label class="flex items-center cursor-pointer text-sm select-none">
                                <span class="mr-2 font-medium text-gray-600">Setup 2</span>
                                <div class="relative">
                                    <input type="checkbox" id="h4-toggle-2" class="sr-only peer">
                                    <div class="w-9 h-5 bg-pastel-toggle_off peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-pastel-toggle_on"></div>
                                </div>
                            </label>
                            <button onclick="clearSection('h4')" class="text-xs text-red-500 hover:text-red-700 underline">CLEAR H4</button>
                        </div>
                    </div>

                    <!-- Setup 1 -->
                    <div id="h4-setup-1">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">Sig Buy/Sell</label>
                                <select id="h4-sig" class="w-full p-2 rounded">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>
                                    <option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option>
                                    <option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig H4</label>
                                <input type="number" step="0.01" id="h4-wick" class="w-full p-2 rounded" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
                            </div>
                            <div class="col-span-1 md:col-span-2 grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Sideway Low</label>
                                    <input type="number" step="0.01" id="h4-low" class="w-full p-2 rounded">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Sideway High</label>
                                    <input type="number" step="0.01" id="h4-high" class="w-full p-2 rounded">
                                </div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div id="h4-tp1-box" class="tp-box border rounded p-2 flex items-center justify-between">
                                <span class="font-semibold text-sm">TP1 H4 (+/- 15) : <span id="h4-tp1-val">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="h4-tp1-check">TP</label>
                                    <input type="checkbox" id="h4-tp1-check" class="tp-checkbox">
                                </div>
                            </div>
                            <div id="h4-tp2-box" class="tp-box border rounded p-2 flex items-center justify-between mt-2">
                                <span class="font-semibold text-sm">TP2 H4 (+/- 30) : <span id="h4-tp2-val">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="h4-tp2-check">TP</label>
                                    <input type="checkbox" id="h4-tp2-check" class="tp-checkbox">
                                </div>
                            </div>
                        </div>
                        <div id="h4-msg" class="min-h-[1.5rem]"></div>
                    </div>

                    <!-- Setup 2 -->
                    <div id="h4-setup-2" class="hidden mt-4 pt-4 border-t-2 border-dashed border-amber-200">
                        <h4 class="text-sm font-bold text-gray-500 mb-3 bg-white inline-block px-2 py-1 rounded">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà 2 (Setup 2)</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">Sig Buy/Sell (2)</label>
                                <select id="h4-sig-2" class="w-full p-2 rounded">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>
                                    <option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option>
                                    <option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig (2)</label>
                                <input type="number" step="0.01" id="h4-wick-2" class="w-full p-2 rounded" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div id="h4-tp1-box-2" class="tp-box border rounded p-2 flex items-center justify-between">
                                <span class="font-semibold text-sm">TP1 (+/- 15) : <span id="h4-tp1-val-2">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="h4-tp1-check-2">TP</label>
                                    <input type="checkbox" id="h4-tp1-check-2" class="tp-checkbox">
                                </div>
                            </div>
                            <div id="h4-tp2-box-2" class="tp-box border rounded p-2 flex items-center justify-between mt-2">
                                <span class="font-semibold text-sm">TP2 (+/- 30) : <span id="h4-tp2-val-2">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="h4-tp2-check-2">TP</label>
                                    <input type="checkbox" id="h4-tp2-check-2" class="tp-checkbox">
                                </div>
                            </div>
                        </div>
                        <div id="h4-msg-2" class="min-h-[1.5rem]"></div>
                    </div>
                </div>

                <!-- H1 -->
                <div class="bg-rose-50 p-4 rounded-xl border border-rose-200 shadow-sm relative">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-pastel-text">H1</h3>
                        <div class="flex gap-3 items-center">
                            <!-- No Setup 2 Toggle Here -->
                            <button onclick="clearSection('h1')" class="text-xs text-red-500 hover:text-red-700 underline">CLEAR H1</button>
                        </div>
                    </div>

                    <!-- Setup 1 -->
                    <div id="h1-setup-1">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">Sig Buy/Sell (6 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</label>
                                <select id="h1-sig" class="w-full p-2 rounded">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>
                                    <option value="Buy P1">Buy P1</option>
                                    <option value="Buy P2">Buy P2</option>
                                    <option value="Buy P3">Buy P3</option>
                                    <option value="Sell P1">Sell P1</option>
                                    <option value="Sell P2">Sell P2</option>
                                    <option value="Sell P3">Sell P3</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig H1</label>
                                <input type="number" step="0.01" id="h1-wick" class="w-full p-2 rounded" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
                            </div>
                            <div class="col-span-1 md:col-span-2 grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Sideway Low</label>
                                    <input type="number" step="0.01" id="h1-low" class="w-full p-2 rounded">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Sideway High</label>
                                    <input type="number" step="0.01" id="h1-high" class="w-full p-2 rounded">
                                </div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div id="h1-tp1-box" class="tp-box border rounded p-2 flex items-center justify-between">
                                <span class="font-semibold text-sm">TP1 H1 (+/- 10) : <span id="h1-tp1-val">...</span></span>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm cursor-pointer" for="h1-tp1-check">TP</label>
                                    <input type="checkbox" id="h1-tp1-check" class="tp-checkbox">
                                </div>
                            </div>
                            <!-- No TP2 Box Here -->
                        </div>
                        <div id="h1-msg" class="min-h-[1.5rem]"></div>
                    </div>

                    <!-- No Setup 2 Section Here -->
                </div>

                <!-- Daily Notes -->
                <div class="bg-white p-4 rounded-xl border border-pastel-header shadow-sm">
                    <label class="block font-bold text-pastel-text mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label>
                    <textarea id="daily-note" class="w-full h-24 p-2 rounded" placeholder="‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..."></textarea>
                </div>

            </section>

            <!-- Summary Footer -->
            <section id="summary-section" class="summary-section bg-white p-6 rounded-xl border border-pastel-header shadow-lg mt-8">
                <h2 class="text-2xl font-bold text-center text-pastel-text mb-4 border-b pb-2">‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° Trading Journal</h2>
                <div id="summary-content">Loading...</div>
                <!-- Hidden Note Container for Print Only -->
                <div id="print-daily-note" class="hidden mt-4 pt-4 border-t border-gray-300"></div>
            </section>

        </div>
    </div>

</body>
</html>
