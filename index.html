<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Trading Journal Pro + Telegram</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Sarabun', 'sans-serif'],
                    },
                    colors: {
                        pastel: {
                            bg: '#f1f8e9',       /* Very light green background */
                            card: '#ffffff',     /* White card */
                            header: '#dcedc8',   /* Light green header */
                            accent: '#8bc34a',   /* Green accent */
                            text: '#33691e',     /* Dark green text */
                            buy: '#c8e6c9',      /* Green for Buy */
                            sell: '#f8bbd0',     /* Pink for Sell */
                            done: '#cfd8dc',     /* Gray for Done */
                            
                            /* Toggle Colors */
                            toggle_off: '#000000', /* Black (Off) */
                            toggle_on: '#81d4fa'   /* Blue Pastel (On) */
                        }
                    },
                    boxShadow: {
                        'soft': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
                        'glow': '0 0 15px rgba(139, 195, 74, 0.3)',
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f4f9f4; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏ö‡∏≤‡∏¢‡∏ï‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô */
            scroll-behavior: smooth;
        }
        
        /* Custom Checkbox */
        .tp-checkbox {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: #558b2f;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .tp-checkbox:checked {
            transform: scale(1.1);
        }

        /* TP Block Styling */
        .tp-box {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .tp-box:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        .tp-box.buy-mode { background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-color: #a5d6a7; color: #1b5e20; }
        .tp-box.sell-mode { background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); border-color: #f48fb1; color: #880e4f; }
        .tp-box.done-mode { background-color: #eceff1; border-color: #cfd8dc; color: #90a4ae; text-decoration: line-through; opacity: 0.8; box-shadow: none; }

        /* Scroll to Top Button */
        #scrollTopBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 99;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 15px;
            border-radius: 50%;
            font-size: 18px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        #scrollTopBtn.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #scrollTopBtn.visible:hover {
            transform: scale(1.1) translateY(-3px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        /* Dedicated Print Area - Hidden on Screen */
        #print-output {
            display: none;
        }

        /* Print Styles */
        @media print {
            body > *:not(#print-output) {
                display: none !important;
            }
            #print-output {
                display: block !important;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                background-color: white;
                padding: 20px;
            }
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                box-shadow: none !important;
                text-shadow: none !important;
            }
            #print-output .grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
        }
        
        /* Input Styles */
        input[type="number"], input[type="text"], select, textarea {
            border: 1px solid #e0e0e0;
            background-color: #ffffff;
            transition: all 0.2s ease;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #8bc34a;
            box-shadow: 0 0 0 3px rgba(139, 195, 74, 0.2), inset 0 1px 2px rgba(0,0,0,0.05);
            transform: translateY(-1px);
        }

        /* Price Ticker Animation */
        .price-up { color: #16a34a; transition: color 0.3s; }
        .price-down { color: #dc2626; transition: color 0.3s; }
        
        /* Blinking Dot for Realtime */
        @keyframes blink-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(0.8); }
        }
        .live-dot {
            width: 8px;
            height: 8px;
            background-color: #4ade80; /* green-400 */
            border-radius: 50%;
            display: inline-block;
            animation: blink-dot 1.5s infinite ease-in-out;
            box-shadow: 0 0 8px #4ade80;
        }
        
        /* Summary Card Styling */
        .conf-card {
            border-left: 4px solid #6366f1; /* Indigo-500 */
            transition: transform 0.2s;
        }
        .conf-card:hover {
            transform: translateX(2px);
        }
    </style>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyBxg46N-kB1zDyrIEAnVqlACqmmOZnu6Fg",
            authDomain: "mytradingjournal-208c5.firebaseapp.com",
            projectId: "mytradingjournal-208c5",
            storageBucket: "mytradingjournal-208c5.firebasestorage.app",
            messagingSenderId: "692684967717",
            appId: "1:692684967717:web:1cac3a8877ae65c49554cc",
            measurementId: "G-JKF602BZDS"
        };

        // --- Variables ---
        let db, dataDocRef;
        const publicDocPath = "/publicJournal/sharedData";

        // --- Init ---
        document.addEventListener('DOMContentLoaded', async () => {
            initBinanceWS();
            initTelegram(); // Init Telegram Settings

            try {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                db = getFirestore(app);
                await signInAnonymously(auth);
                
                dataDocRef = doc(db, publicDocPath);
                
                onSnapshot(dataDocRef, (docSnap) => {
                    if (docSnap.exists()) {
                        loadDataToUI(docSnap.data());
                        document.getElementById('status-indicator').innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß (Sync)";
                        document.getElementById('status-indicator').className = "text-sm text-green-700 font-medium bg-green-50 px-2 py-1 rounded-full border border-green-200";
                    }
                });

                setupEventListeners();
                
            } catch (e) {
                console.error("Firebase Error:", e);
                document.getElementById('status-indicator').innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ";
                document.getElementById('status-indicator').className = "text-sm text-red-600 font-medium bg-red-50 px-2 py-1 rounded-full border border-red-200";
            }
        });

        // --- Telegram Integration Logic ---
        let telegramConfig = {
            botToken: '',
            chatId: '',
            enabled: false
        };
        
        // Anti-Spam / Cooldown for Live Alerts
        let alertCooldowns = new Map(); 
        const COOLDOWN_MINUTES = 5; 

        function initTelegram() {
            const savedConfig = localStorage.getItem('telegramConfig');
            if (savedConfig) {
                // ‡∏ñ‡πâ‡∏≤ user ‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏ß‡πâ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡∏•‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ù‡∏±‡∏á‡∏ï‡∏•‡∏≠‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ)
                // ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ù‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô Default ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà
                const parsed = JSON.parse(savedConfig);
                // ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤ user ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ù‡∏±‡∏á ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå cache
                // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å ‡∏ú‡∏°‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ù‡∏±‡∏á ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô localStorage ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
                if(parsed.botToken) telegramConfig.botToken = parsed.botToken;
                if(parsed.chatId) telegramConfig.chatId = parsed.chatId;
                if(parsed.enabled !== undefined) telegramConfig.enabled = parsed.enabled;
            }
            
            // Set values to UI
            document.getElementById('tg-bot-token').value = telegramConfig.botToken;
            document.getElementById('tg-chat-id').value = telegramConfig.chatId;
            document.getElementById('tg-enable').checked = telegramConfig.enabled;
        }

        window.saveTelegramSettings = () => {
            telegramConfig.botToken = document.getElementById('tg-bot-token').value.trim();
            telegramConfig.chatId = document.getElementById('tg-chat-id').value.trim();
            telegramConfig.enabled = document.getElementById('tg-enable').checked;
            
            localStorage.setItem('telegramConfig', JSON.stringify(telegramConfig));
            window.closeModal('telegramModal');
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Telegram ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
        window.testTelegramConnection = async () => {
            // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡∏î‡∏à‡∏≤‡∏Å Input ‡πÄ‡∏•‡∏¢ (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)
            const token = document.getElementById('tg-bot-token').value.trim();
            const chatId = document.getElementById('tg-chat-id').value.trim();

            if (!token || !chatId) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Token ‡πÅ‡∏•‡∏∞ Chat ID ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
                return;
            }

            const btn = document.getElementById('btn-test-tg');
            const originalText = btn.innerText;
            btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...";
            btn.disabled = true;

            const msg = `üîî <b>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</b>\n\n‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ö‡∏≠‡∏ó‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ\n‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleTimeString('th-TH')}`;
            const encodedText = encodeURIComponent(msg);
            const url = `https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${encodedText}&parse_mode=HTML`;

            try {
                // ‡πÉ‡∏ä‡πâ no-cors ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° alert ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                await fetch(url, { method: 'GET', mode: 'no-cors' });
                alert("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß! üì®\n\n‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Telegram ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\n1. ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏î Start ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏ö‡∏≠‡∏ó‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á (‡∏ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß)?\n2. ‡∏î‡∏∂‡∏á‡∏ö‡∏≠‡∏ó‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á (‡∏ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°)?\n3. Token/Chat ID ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?");
            } catch (e) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: " + e.message);
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        };

        async function sendTelegramMessage(text) {
            if (!telegramConfig.enabled || !telegramConfig.botToken || !telegramConfig.chatId) {
                console.log("Telegram disabled or missing config");
                return false;
            }

            // Encode params for GET request
            const encodedText = encodeURIComponent(text);
            const url = `https://api.telegram.org/bot${telegramConfig.botToken}/sendMessage?chat_id=${telegramConfig.chatId}&text=${encodedText}&parse_mode=HTML`;
            
            // Timeout logic
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 sec timeout

            try {
                // Use mode: 'no-cors' to bypass browser CORS checks for sending (Opaque response)
                await fetch(url, { 
                    method: 'GET',
                    mode: 'no-cors',
                    signal: controller.signal
                });
                
                // With no-cors, we can't check response.ok or status. 
                // We assume success if no network error occurred.
                console.log("Telegram request sent (Opaque/No-CORS)");
                return true; 

            } catch (error) {
                console.error("Telegram Send Failed:", error);
                if (error.name === 'AbortError') {
                    // Silent fail or alert depending on context
                }
                return false;
            } finally {
                clearTimeout(timeoutId);
            }
        }

        // --- Confluence to Telegram ---
        window.sendConfluenceToTelegram = async () => {
            const btn = document.getElementById('btn-send-tg');
            const originalText = btn.innerHTML;
            
            try {
                btn.innerHTML = 'Sending...';
                btn.disabled = true;

                const date = document.getElementById('date').value || '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ';
                let message = `üìä <b>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏ú‡∏ô‡πÄ‡∏ó‡∏£‡∏î (Confluence Zones)</b>\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${date}\n\n`;

                // Sentiment
                let buyC = 0, sellC = 0;
                ['mn', 'wk', 'd', 'h4', 'h1'].forEach(tf => {
                    const s1El = document.getElementById(`${tf}-sig`);
                    const s1 = s1El ? s1El.value : "";
                    if(s1.includes("Buy")) buyC++; if(s1.includes("Sell")) sellC++;
                    
                    const toggleEl = document.getElementById(`${tf}-toggle-2`);
                    const t2 = toggleEl ? toggleEl.checked : false; 
                    
                    const s2El = document.getElementById(`${tf}-sig-2`);
                    const s2 = s2El ? s2El.value : "";
                    if(t2 && s2.includes("Buy")) buyC++; if(t2 && s2.includes("Sell")) sellC++;
                });

                if (buyC > sellC) message += `üêÇ <b>Sentiment: BULLISH</b> (‡∏°‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô)\n`;
                else if (sellC > buyC) message += `üêª <b>Sentiment: BEARISH</b> (‡∏°‡∏≠‡∏á‡∏•‡∏á)\n`;
                else message += `‚öñÔ∏è <b>Sentiment: MIXED</b> (‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô)\n`;
                
                message += `------------------------------\n`;

                // Daily Range
                const drPrice = document.getElementById('dr-price').value;
                if(drPrice) {
                    const res = (parseFloat(drPrice) + 5).toFixed(2);
                    const sup = (parseFloat(drPrice) - 5).toFixed(2);
                    message += `üèô <b>‡∏Å‡∏£‡∏≠‡∏ö‡∏ß‡∏±‡∏ô (07:00)</b>: ${drPrice}\nüî¥ ‡∏ï‡πâ‡∏≤‡∏ô: ${res} | üü¢ ‡∏£‡∏±‡∏ö: ${sup}\n\n`;
                }

                // Get Clusters
                const confCards = document.querySelectorAll('.conf-card');
                
                if (confCards.length === 0) {
                    message += `<i>*‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏ã‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç*</i>\n`;
                } else {
                    message += `üéØ <b>‡πÇ‡∏ã‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Focus Zones):</b>\n`;
                    confCards.forEach(card => {
                        const title = card.querySelector('.text-indigo-700').innerText; 
                        const count = card.querySelector('.text-indigo-400').innerText; 
                        message += `\nüìç <b>${title}</b> (${count})\n`;
                        
                        const items = card.querySelectorAll('.flex.justify-between');
                        items.forEach(item => {
                            const label = item.children[0].innerText;
                            const val = item.children[1].innerText;
                            message += `   ‚ñ™Ô∏è ${label}: <code>${val}</code>\n`;
                        });
                    });
                }

                message += `\n------------------------------\n`;
                message += `<i>Generated by Gold Trading Journal Pro</i>`;

                await sendTelegramMessage(message);
                
                alert("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Telegram ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ\n(‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏î Start ‡∏ö‡∏≠‡∏ó‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á)");
                
            } catch (err) {
                console.error("Main Send Error:", err);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
            } finally {
                // Ensure button is always reset
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        };

        // --- Live Alert to Telegram Logic ---
        function checkAndSendLiveAlert(tfName, type, targetPrice, dist, context, currentBrokerPrice) {
            // Unique ID for this specific alert: e.g., "H4-TP1-2650.00"
            const alertId = `${tfName}-${type}-${targetPrice.toFixed(2)}`;
            const now = Date.now();
            
            // Check Cooldown
            if (alertCooldowns.has(alertId)) {
                const lastTime = alertCooldowns.get(alertId);
                if (now - lastTime < COOLDOWN_MINUTES * 60 * 1000) {
                    return; // Still in cooldown
                }
            }

            // Prepare Message
            let emoji = "üîî";
            if (type.includes("TP")) emoji = "üí∞";
            if (type.includes("Entry")) emoji = "üöÄ";

            let msg = `${emoji} <b>LIVE ALERT: ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏ã‡∏ô!</b>\n\n`;
            msg += `üìå <b>Setup: ${tfName}</b> (${type})\n`;
            msg += `-----------------------------\n`;
            msg += `üíé <b>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</b> <code>${currentBrokerPrice.toFixed(2)}</code>\n`;
            msg += `üìâ <b>‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á:</b> <b>${dist.toFixed(2)}</b> ‡∏à‡∏∏‡∏î\n`;
            msg += `-----------------------------\n`;
            msg += `üìã <b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ú‡∏ô:</b>\n`;
            msg += `üöÄ <b>Entry:</b> ${context.entry}\n`;
            msg += `üí∞ <b>TP1:</b> ${context.tp1}\n`;
            msg += `üí∞ <b>TP2:</b> ${context.tp2}\n`;
            msg += `\n<i>Generated by Gold Trading Journal Pro</i>`;
            
            // Send
            sendTelegramMessage(msg).then(success => {
                if (success) {
                    console.log(`Alert sent for ${alertId}`);
                    alertCooldowns.set(alertId, now);
                }
            });
        }

        // --- Binance WebSocket ---
        let currentBinancePrice = 0;
        let previousPrice = 0;

        function initBinanceWS() {
            const ws = new WebSocket('wss://stream.binance.com:9443/ws/paxgusdt@trade');
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                const price = parseFloat(data.p);
                updatePriceDisplay(price);
            };

            ws.onerror = (error) => {
                console.error("Binance WS Error", error);
                document.getElementById('binance-price-display').innerText = "Conn Err";
            };
        }

        function updatePriceDisplay(price) {
            currentBinancePrice = price;
            const displayEl = document.getElementById('binance-price-display');
            
            if (price > previousPrice) {
                displayEl.classList.remove('price-down');
                displayEl.classList.add('price-up');
            } else if (price < previousPrice) {
                displayEl.classList.remove('price-up');
                displayEl.classList.add('price-down');
            }
            previousPrice = price;
            
            displayEl.innerText = price.toFixed(2);
            calculateBrokerPrice();
        }

        function calculateBrokerPrice() {
            const diffInput = document.getElementById('broker-diff');
            const diff = parseFloat(diffInput.value) || 0;
            const brokerPrice = currentBinancePrice + diff;
            
            document.getElementById('broker-price-display').innerText = brokerPrice.toFixed(2);
            
            // Checks alerts for Top Intelligence Dashboard & Telegram
            checkAlerts(brokerPrice);
        }

        // --- Alert Logic ---
        function checkAlerts(currentPrice) {
            const timeframes = ['mn', 'wk', 'd', 'h4', 'h1'];
            let alertsHtml = '';
            
            const threshold = 3.0; 

            timeframes.forEach(tf => {
                checkSetup(tf, '', currentPrice, threshold, (html, tfName, type, target, dist, context) => {
                    alertsHtml += html;
                    // Trigger Telegram Alert
                    checkAndSendLiveAlert(tfName, type, target, dist, context, currentPrice);
                });
                
                const toggle = document.getElementById(`${tf}-toggle-2`);
                if (toggle && toggle.checked) {
                    checkSetup(tf, '-2', currentPrice, threshold, (html, tfName, type, target, dist, context) => {
                        alertsHtml += html;
                        // Trigger Telegram Alert
                        checkAndSendLiveAlert(tfName, type, target, dist, context, currentPrice);
                    });
                }
            });

            // Update Intelligence Dashboard (Top)
            const summaryAlertContainer = document.getElementById('summary-live-alerts');
            if (summaryAlertContainer) {
                if (alertsHtml === '') {
                    summaryAlertContainer.innerHTML = `<div class="p-3 bg-gray-50 rounded-lg text-gray-400 text-sm text-center italic border border-gray-100 flex flex-col items-center gap-1">
                        <span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡πÇ‡∏ã‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (‡∏£‡∏∞‡∏¢‡∏∞ ${threshold} ‡∏à‡∏∏‡∏î)</span>
                    </div>`;
                } else {
                    summaryAlertContainer.innerHTML = `
                        <div class="grid grid-cols-1 gap-2">
                            ${alertsHtml}
                        </div>
                    `;
                }
            }
        }

        function checkSetup(tf, suffix, price, threshold, callback) {
            const sigEl = document.getElementById(`${tf}-sig${suffix}`);
            const wickEl = document.getElementById(`${tf}-wick${suffix}`);
            
            if (!sigEl || !wickEl || !sigEl.value || !wickEl.value) return;

            const wick = parseFloat(wickEl.value);
            const tfName = tf.toUpperCase() + (suffix ? " (S2)" : "");
            
            // Get Plan Context (Entry, TP1, TP2)
            const tp1El = document.getElementById(`${tf}-tp1-val${suffix}`);
            const tp2El = document.getElementById(`${tf}-tp2-val${suffix}`);
            
            const tp1Val = (tp1El && tp1El.innerText !== "..." && tp1El.innerText !== "") ? tp1El.innerText : "-";
            const tp2Val = (tp2El && tp2El.innerText !== "..." && tp2El.innerText !== "") ? tp2El.innerText : "-";

            const context = { entry: wick.toFixed(2), tp1: tp1Val, tp2: tp2Val };

            // Check Entry
            const distEntry = Math.abs(price - wick);
            if (distEntry <= threshold) {
                const html = createAlertItem(tfName, "‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤/‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≠‡∏ö", wick, distEntry, "bg-white border-l-4 border-blue-500 text-gray-700 shadow-sm");
                callback(html, tfName, "‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤/‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≠‡∏ö", wick, distEntry, context);
            }

            // Check TP1
            if (tp1El && tp1El.innerText !== "..." && tp1El.innerText !== "") {
                const tp1 = parseFloat(tp1El.innerText);
                const distTp1 = Math.abs(price - tp1);
                
                if (distTp1 <= threshold) {
                    const html = createAlertItem(tfName, "TP1", tp1, distTp1, "bg-white border-l-4 border-orange-500 text-gray-700 shadow-sm");
                    callback(html, tfName, "TP1", tp1, distTp1, context);
                }
            }

            // Check TP2
            if (tp2El && tp2El.innerText !== "..." && tp2El.innerText !== "") {
                const tp2 = parseFloat(tp2El.innerText);
                const distTp2 = Math.abs(price - tp2);
                
                if (distTp2 <= threshold) {
                    const html = createAlertItem(tfName, "TP2", tp2, distTp2, "bg-white border-l-4 border-emerald-500 text-gray-700 shadow-sm");
                    callback(html, tfName, "TP2", tp2, distTp2, context);
                }
            }
        }

        function createAlertItem(tf, type, targetPrice, dist, classes) {
            return `
            <div class="${classes} p-2 rounded-r-lg border-t border-b border-r border-gray-100 flex justify-between items-center transition-all hover:shadow-md text-sm">
                <div>
                    <div class="flex items-center gap-2 mb-0.5">
                        <span class="text-[10px] font-bold uppercase tracking-wider bg-gray-100 text-gray-600 px-1.5 rounded">${tf}</span>
                        <span class="text-xs font-bold ${type.includes('TP') ? 'text-indigo-600' : 'text-blue-600'}">${type}</span>
                    </div>
                    <div class="text-base font-mono font-bold leading-none text-gray-800">${targetPrice.toFixed(2)}</div>
                </div>
                <div class="text-right">
                    <div class="text-[9px] text-gray-400">‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á</div>
                    <div class="text-xs font-bold text-red-500">${dist.toFixed(2)}</div>
                </div>
            </div>`;
        }


        // --- Data Handling ---
        const fields = [
            'date', 'dr-price', 'broker-diff',
            'mn-sig', 'mn-wick', 'mn-tp1-check', 'mn-tp2-check', 'mn-low', 'mn-high',
            'mn-toggle-2', 'mn-sig-2', 'mn-wick-2', 'mn-tp1-check-2', 'mn-tp2-check-2',
            'wk-sig', 'wk-wick', 'wk-tp1-check', 'wk-tp2-check', 'wk-low', 'wk-high',
            'wk-toggle-2', 'wk-sig-2', 'wk-wick-2', 'wk-tp1-check-2', 'wk-tp2-check-2',
            'd-sig', 'd-wick', 'd-tp1-check', 'd-tp2-check', 'd-low', 'd-high',
            'd-toggle-2', 'd-sig-2', 'd-wick-2', 'd-tp1-check-2', 'd-tp2-check-2',
            'h4-sig', 'h4-wick', 'h4-tp1-check', 'h4-tp2-check', 'h4-low', 'h4-high',
            'h4-toggle-2', 'h4-sig-2', 'h4-wick-2', 'h4-tp1-check-2', 'h4-tp2-check-2',
            'h1-sig', 'h1-wick', 'h1-tp1-check', 'h1-low', 'h1-high',
            'daily-note'
        ];

        function loadDataToUI(data) {
            fields.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                if (el.type === 'checkbox') el.checked = data[id] || false;
                else el.value = data[id] || '';
            });
            recalcAll();
        }

        async function saveData() {
            if (!dataDocRef) return;
            const data = {};
            fields.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                data[id] = el.type === 'checkbox' ? el.checked : el.value;
            });
            await setDoc(dataDocRef, data);
        }

        // --- Logic & Calculations ---
        
        function recalcAll() {
            const drPrice = parseFloat(document.getElementById('dr-price').value) || 0;
            if (drPrice) {
                document.getElementById('dr-res').innerText = (drPrice + 5).toFixed(2);
                document.getElementById('dr-sup').innerText = (drPrice - 5).toFixed(2);
            } else {
                document.getElementById('dr-res').innerText = "...";
                document.getElementById('dr-sup').innerText = "...";
            }

            processTimeframe('mn', 500, 1000);
            processTimeframe('wk', 150, 300);
            processTimeframe('d', 50, 100);
            processTimeframe('h4', 15, 30);
            processTimeframe('h1', 10, null);

            updateSummary();
            calculateBrokerPrice();
        }

        function processTimeframe(prefix, tp1Diff, tp2Diff) {
            calcTF(prefix, '', tp1Diff, tp2Diff);
            const toggle = document.getElementById(`${prefix}-toggle-2`);
            const container2 = document.getElementById(`${prefix}-setup-2`);
            if (toggle) {
                if (toggle.checked) {
                    if(container2) container2.classList.remove('hidden');
                    calcTF(prefix, '-2', tp1Diff, tp2Diff);
                } else {
                    if(container2) container2.classList.add('hidden');
                }
            }
        }

        function calcTF(prefix, suffix, tp1Diff, tp2Diff) {
            const sigId = `${prefix}-sig${suffix}`;
            const wickId = `${prefix}-wick${suffix}`;
            const tp1CheckId = `${prefix}-tp1-check${suffix}`;
            const tp2CheckId = `${prefix}-tp2-check${suffix}`;
            
            const sigEl = document.getElementById(sigId);
            const wickEl = document.getElementById(wickId);
            const tp1El = document.getElementById(`${prefix}-tp1-val${suffix}`);
            const tp2El = document.getElementById(`${prefix}-tp2-val${suffix}`);
            const box1 = document.getElementById(`${prefix}-tp1-box${suffix}`);
            const box2 = document.getElementById(`${prefix}-tp2-box${suffix}`);
            const msgEl = document.getElementById(`${prefix}-msg${suffix}`);

            if (!sigEl || !wickEl) return;

            const sig = sigEl.value;
            const wick = parseFloat(wickEl.value);
            const tp1Check = document.getElementById(tp1CheckId)?.checked || false;
            const tp2Check = document.getElementById(tp2CheckId)?.checked || false;

            let tp1Val = 0, tp2Val = 0;

            if(box1) box1.className = "tp-box border rounded p-2 flex items-center justify-between";
            if(box2) box2.className = "tp-box border rounded p-2 flex items-center justify-between mt-2";
            if(msgEl) msgEl.innerText = ""; 

            if (!sig) {
                if(tp1El) tp1El.innerText = "...";
                if(tp2El) tp2El.innerText = "...";
                return; 
            }

            if (isNaN(wick) || wickEl.value === "") {
                if(tp1El) tp1El.innerText = "...";
                if(tp2El) tp2El.innerText = "...";
                if(msgEl) {
                    msgEl.innerText = "**‡∏£‡∏≠‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig**";
                    msgEl.className = "text-sm text-red-500 font-bold mt-2";
                }
                return;
            }

            if (sig.includes("Buy")) {
                tp1Val = wick + tp1Diff;
                if(tp2Diff !== null) tp2Val = wick + tp2Diff;
                if(box1 && !tp1Check) box1.classList.add("buy-mode");
                if(box2 && tp2Diff !== null && !tp2Check) box2.classList.add("buy-mode");
            } else if (sig.includes("Sell")) {
                tp1Val = wick - tp1Diff;
                if(tp2Diff !== null) tp2Val = wick - tp2Diff;
                if(box1 && !tp1Check) box1.classList.add("sell-mode");
                if(box2 && tp2Diff !== null && !tp2Check) box2.classList.add("sell-mode");
            }
            
            if(tp1El) tp1El.innerText = tp1Val.toFixed(2);
            if(tp2El && tp2Diff !== null) tp2El.innerText = tp2Val.toFixed(2);

            const tfName = prefix.toUpperCase();
            const setupName = suffix ? " (Setup 2)" : "";
            
            if(msgEl) {
                if (tp2Diff === null) {
                    if (tp1Check) {
                        msgEl.innerHTML = `‡∏Ñ‡∏£‡∏ö TP1 (‡∏à‡∏ö‡∏á‡∏≤‡∏ô) ${tfName} ‚úÖ‚úÖ<br>‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${wick.toFixed(2)}`;
                        msgEl.className = "text-sm text-green-700 font-bold mt-2";
                    }
                } else {
                    if (tp1Check && !tp2Check) {
                        msgEl.innerHTML = `‡∏Ñ‡∏£‡∏ö TP1 ${tfName}${setupName} ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏µ‡πà ${tp1Val.toFixed(2)} ‚úÖ ‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏î TP2 ‡∏ó‡∏µ‡πà ${tp2Val.toFixed(2)}<br>‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${wick.toFixed(2)}`;
                        msgEl.className = "text-sm text-orange-600 font-semibold mt-2";
                    } else if (tp1Check && tp2Check) {
                        msgEl.innerHTML = `‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á 2 TP ${tfName}${setupName} ‚úÖ‚úÖ`;
                        msgEl.className = "text-sm text-green-700 font-bold mt-2";
                    }
                }
            }

            if (tp1Check && box1) box1.classList.add("done-mode");
            if (tp2Check && box2) box2.classList.add("done-mode");
        }

        async function clearSection(prefix) {
            fields.forEach(key => {
                if (key.startsWith(prefix + '-')) {
                    const el = document.getElementById(key);
                    if(el) {
                        if(el.type === 'checkbox') el.checked = false;
                        else el.value = '';
                    }
                }
            });
            recalcAll();
            await saveData();
            
            const statusEl = document.getElementById('status-indicator');
            statusEl.innerText = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${prefix.toUpperCase()} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`;
            statusEl.className = "text-sm text-blue-600 font-medium";
            setTimeout(() => {
                 statusEl.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß (Sync)";
                 statusEl.className = "text-sm text-green-700 font-medium bg-green-50 px-2 py-1 rounded-full border border-green-200";
            }, 1500);
        }

        window.clearSection = clearSection;
        window.saveData = saveData;
        window.setDate = () => {
            const d = new Date();
            const dateStr = d.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('date').value = dateStr;
            saveData();
        };

        window.openModal = (id) => {
            const modal = document.getElementById(id);
            if(modal) modal.style.display = 'flex';
        };

        window.closeModal = (id) => {
            const modal = document.getElementById(id);
            if(modal) modal.style.display = 'none';
        };

        window.confirmClearAll = async () => {
            window.closeModal('confirmModal');
            fields.forEach(key => {
                const el = document.getElementById(key);
                if(el) {
                    if(el.type === 'checkbox') el.checked = false;
                    else el.value = '';
                }
            });
            recalcAll();
            await saveData();
            
            const statusEl = document.getElementById('status-indicator');
            statusEl.innerText = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`;
            statusEl.className = "text-sm text-red-600 font-medium";
            setTimeout(() => {
                 statusEl.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß (Sync)";
                 statusEl.className = "text-sm text-green-700 font-medium bg-green-50 px-2 py-1 rounded-full border border-green-200";
            }, 2000);
        };
        
        window.printSummary = () => {
            updateSummary();
            let summaryHTML = document.getElementById('summary-content').innerHTML;
            summaryHTML = summaryHTML.replace(/bg-white/g, 'bg-pastel-bg');
            
            // Adjust alert colors for print/light mode in summary
            summaryHTML = summaryHTML.replace(/text-blue-200/g, 'text-blue-700').replace(/border-blue-700/g, 'border-blue-200').replace(/bg-blue-900\/50/g, 'bg-blue-50');
            summaryHTML = summaryHTML.replace(/text-orange-200/g, 'text-orange-700').replace(/border-orange-700/g, 'border-orange-200').replace(/bg-orange-900\/50/g, 'bg-orange-50');
            summaryHTML = summaryHTML.replace(/text-red-200/g, 'text-red-700').replace(/border-red-700/g, 'border-red-200').replace(/bg-red-900\/50/g, 'bg-red-50');
            
            // Hide Telegram Button in Print
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = summaryHTML;
            const btn = tempDiv.querySelector('#btn-send-tg');
            if(btn) btn.remove();
            summaryHTML = tempDiv.innerHTML;

            const noteContent = document.getElementById('daily-note').value;
            const printArea = document.getElementById('print-output');
            let printHTML = `
                <h1 class="text-2xl font-bold text-center mb-4 text-pastel-text">Trading Journal Summary</h1>
                <p class="text-center mb-6 text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${document.getElementById('date').value || '-'}</p>
                ${summaryHTML}
            `;
            
            if(noteContent) {
                printHTML += `
                <div class="mt-6 border-t pt-4">
                    <h4 class="font-bold text-lg mb-2 text-pastel-text">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                    <div class="p-3 border rounded text-sm text-gray-800 whitespace-pre-wrap bg-pastel-bg">${noteContent}</div>
                </div>`;
            }
            printArea.innerHTML = printHTML;
            setTimeout(() => {
                window.print();
            }, 300);
        };
        
        window.scrollToTop = () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.onscroll = function() {
            const btn = document.getElementById("scrollTopBtn");
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                btn.classList.add("visible");
            } else {
                btn.classList.remove("visible");
            }
        };

        function setupEventListeners() {
            fields.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('change', () => { recalcAll(); saveData(); });
                    el.addEventListener('input', () => { recalcAll(); }); 
                }
            });
        }

        function getTrendIcon(sig) {
            if (!sig) return '<span class="text-gray-300">-</span>';
            if (sig.includes("Buy")) return '<span class="text-green-600 font-bold drop-shadow-sm">‚ñ≤ BUY</span>';
            if (sig.includes("Sell")) return '<span class="text-rose-600 font-bold drop-shadow-sm">‚ñº SELL</span>';
            return '-';
        }

        function getStatusBadge(htmlContent) {
            if (!htmlContent) return '<span class="px-2 py-1 text-xs font-bold text-blue-500 bg-blue-100 rounded-full shadow-sm">Active</span>';
            if (htmlContent.includes("‚úÖ‚úÖ")) return '<span class="px-2 py-1 text-xs font-bold text-white bg-gradient-to-r from-green-500 to-green-600 rounded-full shadow-md">Complete</span>';
            if (htmlContent.includes("‚úÖ")) return '<span class="px-2 py-1 text-xs font-bold text-white bg-gradient-to-r from-orange-400 to-orange-500 rounded-full shadow-md">TP1 Hit</span>';
            if (htmlContent.includes("‡∏£‡∏≠‡πÑ‡∏™‡πâ")) return '<span class="px-2 py-1 text-xs font-bold text-gray-500 bg-gray-200 rounded-full shadow-inner">Waiting</span>';
            return '<span class="px-2 py-1 text-xs font-bold text-blue-500 bg-blue-100 rounded-full shadow-sm">Active</span>';
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summary-content');
            const topIntelligenceDiv = document.getElementById('intelligence-dashboard-content');
            if(!summaryDiv) return;

            let buyCount = 0;
            let sellCount = 0;
            const timeframes = ['mn', 'wk', 'd', 'h4', 'h1'];
            
            // --- Collect All Levels for Confluence Check ---
            let allLevels = [];

            timeframes.forEach(tf => {
                const s1El = document.getElementById(`${tf}-sig`);
                const s1 = s1El ? s1El.value : "";
                const wick1El = document.getElementById(`${tf}-wick`);
                const wick1 = wick1El && wick1El.value ? parseFloat(wick1El.value) : null;
                
                if (s1 && wick1 !== null) {
                    allLevels.push({ type: 'Entry/Wick', tf: tf.toUpperCase(), price: wick1 });
                    
                    const tp1El = document.getElementById(`${tf}-tp1-val`);
                    if(tp1El && tp1El.innerText !== "...") allLevels.push({ type: 'TP1', tf: tf.toUpperCase(), price: parseFloat(tp1El.innerText) });
                    
                    const tp2El = document.getElementById(`${tf}-tp2-val`);
                    if(tp2El && tp2El.innerText !== "..." && tp2El.innerText !== "") allLevels.push({ type: 'TP2', tf: tf.toUpperCase(), price: parseFloat(tp2El.innerText) });
                }

                // Setup 2
                const toggleEl = document.getElementById(`${tf}-toggle-2`);
                if(toggleEl && toggleEl.checked) {
                    const s2El = document.getElementById(`${tf}-sig-2`);
                    const s2 = s2El ? s2El.value : "";
                    const wick2El = document.getElementById(`${tf}-wick-2`);
                    const wick2 = wick2El && wick2El.value ? parseFloat(wick2El.value) : null;

                    if(s2 && wick2 !== null) {
                        allLevels.push({ type: 'Entry/Wick', tf: tf.toUpperCase()+'(S2)', price: wick2 });
                        
                        const tp1_2El = document.getElementById(`${tf}-tp1-val-2`);
                        if(tp1_2El && tp1_2El.innerText !== "...") allLevels.push({ type: 'TP1', tf: tf.toUpperCase()+'(S2)', price: parseFloat(tp1_2El.innerText) });
                        
                        const tp2_2El = document.getElementById(`${tf}-tp2-val-2`);
                        if(tp2_2El && tp2_2El.innerText !== "..." && tp2_2El.innerText !== "") allLevels.push({ type: 'TP2', tf: tf.toUpperCase()+'(S2)', price: parseFloat(tp2_2El.innerText) });
                    }
                }

                // Sentiment Calc
                const toggle2 = toggleEl ? toggleEl.checked : false;
                let s2 = "";
                if(toggle2) {
                    const s2El = document.getElementById(`${tf}-sig-2`);
                    s2 = s2El ? s2El.value : "";
                }
                if(s1 && s1.includes("Buy")) buyCount++;
                if(s1 && s1.includes("Sell")) sellCount++;
                if(toggle2 && s2 && s2.includes("Buy")) buyCount++;
                if(toggle2 && s2 && s2.includes("Sell")) sellCount++;
            });

            // --- Confluence Calculation ---
            allLevels.sort((a, b) => a.price - b.price);
            let clusters = [];
            if(allLevels.length > 0) {
                let currentCluster = [allLevels[0]];
                for(let i=1; i<allLevels.length; i++) {
                    if(Math.abs(allLevels[i].price - allLevels[i-1].price) <= 5.0) {
                        currentCluster.push(allLevels[i]);
                    } else {
                        if(currentCluster.length > 1) clusters.push(currentCluster);
                        currentCluster = [allLevels[i]];
                    }
                }
                if(currentCluster.length > 1) clusters.push(currentCluster);
            }

            // --- Build Intelligence HTML (Top) ---
            let intelHTML = '';
            
            // Confluence
            intelHTML += `<div class="mb-4">
                <h3 class="font-bold text-gray-700 text-sm mb-2 flex items-center gap-2">
                    üéØ ‡πÇ‡∏ã‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Confluence Zones)
                    <span class="text-[10px] font-normal text-indigo-500 bg-indigo-50 px-2 py-0.5 rounded-full border border-indigo-100">‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 5 ‡∏à‡∏∏‡∏î</span>
                </h3>`;
            
            if(clusters.length > 0) {
                intelHTML += `<div class="grid grid-cols-1 md:grid-cols-2 gap-3">`;
                clusters.forEach(cluster => {
                    const avgPrice = cluster.reduce((sum, item) => sum + item.price, 0) / cluster.length;
                    
                    let itemsHTML = '';
                    cluster.forEach(i => {
                        let typeColor = 'bg-gray-100 text-gray-600';
                        if(i.type.includes('TP1')) typeColor = 'bg-orange-50 text-orange-600 border-orange-100';
                        if(i.type.includes('TP2')) typeColor = 'bg-green-50 text-green-600 border-green-100';
                        if(i.type.includes('Entry')) typeColor = 'bg-blue-50 text-blue-600 border-blue-100';
                        
                        itemsHTML += `
                        <div class="flex justify-between text-[10px] mb-1 last:mb-0">
                            <span class="font-semibold text-gray-500">${i.tf} ${i.type}</span>
                            <span class="font-mono font-bold ${typeColor.split(' ')[1]}">${i.price.toFixed(2)}</span>
                        </div>`;
                    });

                    intelHTML += `
                    <div class="bg-white rounded border border-indigo-100 shadow-sm conf-card overflow-hidden">
                        <div class="bg-indigo-50 px-3 py-1.5 flex justify-between items-center border-b border-indigo-100">
                            <span class="font-bold text-indigo-700 text-sm">Zone ${avgPrice.toFixed(0)}</span>
                            <span class="text-[9px] text-indigo-400 bg-white px-1.5 rounded-full border border-indigo-100">${cluster.length} matches</span>
                        </div>
                        <div class="p-2">
                            ${itemsHTML}
                        </div>
                    </div>`;
                });
                intelHTML += `</div>`;
            } else {
                intelHTML += `<div class="bg-white rounded border border-dashed border-gray-300 p-3 text-gray-400 text-xs text-center italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏ã‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</div>`;
            }
            intelHTML += `</div>`;

            // Live Status Container
            intelHTML += `<div>
                <h3 class="font-bold text-gray-700 text-sm mb-2 flex items-center gap-2">
                    üîî ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                    <span class="text-[10px] font-normal text-orange-500 bg-orange-50 px-2 py-0.5 rounded-full border border-orange-100">Live Alerts (‡∏£‡∏∞‡∏¢‡∏∞ 3 ‡∏à‡∏∏‡∏î)</span>
                </h3>
                <div id="summary-live-alerts">
                    <p class="text-gray-400 text-xs italic text-center py-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤...</p>
                </div>
            </div>`;

            if(topIntelligenceDiv) topIntelligenceDiv.innerHTML = intelHTML;


            // --- Build Summary Footer HTML (Bottom) ---
            let sentimentHTML = '';
            if(buyCount > sellCount) {
                sentimentHTML = `<div class="bg-gradient-to-r from-green-50 to-white border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded-lg shadow-md flex justify-between items-center transition-all hover:shadow-lg">
                    <div>
                        <p class="font-bold text-lg drop-shadow-sm">üêÇ Bullish Sentiment (‡∏°‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô)</p>
                        <p class="text-sm opacity-80">‡πÅ‡∏£‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÉ‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (${buyCount} vs ${sellCount})</p>
                    </div>
                    <div class="text-4xl filter drop-shadow-md">üöÄ</div>
                </div>`;
            } else if(sellCount > buyCount) {
                sentimentHTML = `<div class="bg-gradient-to-r from-rose-50 to-white border-l-4 border-rose-500 text-rose-700 p-4 mb-6 rounded-lg shadow-md flex justify-between items-center transition-all hover:shadow-lg">
                    <div>
                        <p class="font-bold text-lg drop-shadow-sm">üêª Bearish Sentiment (‡∏°‡∏≠‡∏á‡∏•‡∏á)</p>
                        <p class="text-sm opacity-80">‡πÅ‡∏£‡∏á‡∏Ç‡∏≤‡∏¢‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÉ‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (${sellCount} vs ${buyCount})</p>
                    </div>
                    <div class="text-4xl filter drop-shadow-md">ü©∏</div>
                </div>`;
            } else if (buyCount === 0 && sellCount === 0) {
                 sentimentHTML = `<div class="bg-gray-50 border-l-4 border-gray-400 text-gray-600 p-4 mb-6 rounded-lg shadow-sm">
                    <p class="font-bold">Waiting for Setup...</p>
                </div>`;
            } else {
                sentimentHTML = `<div class="bg-gradient-to-r from-yellow-50 to-white border-l-4 border-yellow-400 text-yellow-700 p-4 mb-6 rounded-lg shadow-md flex justify-between items-center transition-all hover:shadow-lg">
                    <div>
                        <p class="font-bold text-lg drop-shadow-sm">‚öñÔ∏è Mixed Sentiment (‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô)</p>
                        <p class="text-sm opacity-80">‡πÅ‡∏£‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏¢‡∏û‡∏≠‡πÜ ‡∏Å‡∏±‡∏ô (${buyCount} vs ${sellCount}) ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏™‡∏ß‡∏¥‡∏á</p>
                    </div>
                    <div class="text-4xl filter drop-shadow-md">‚ö†Ô∏è</div>
                </div>`;
            }

            let html = sentimentHTML;

            // --- Grid Layout for Cards (OPTIMIZED FOR MOBILE) ---
            const drPriceEl = document.getElementById('dr-price');
            const drPrice = drPriceEl ? drPriceEl.value || '-' : '-';
            const drResEl = document.getElementById('dr-res');
            const drRes = drResEl ? drResEl.innerText : "-";
            const drSupEl = document.getElementById('dr-sup');
            const drSup = drSupEl ? drSupEl.innerText : "-";

            html += `
            <div class="mb-6 grid grid-cols-3 gap-2 md:gap-4 text-center">
                <!-- Resistance -->
                <div class="bg-red-50 rounded-lg border border-red-100 p-2 md:p-4 flex flex-col justify-center shadow-sm">
                    <span class="text-[10px] md:text-xs text-red-400 font-bold uppercase tracking-wide">Resistance (‡∏ï‡πâ‡∏≤‡∏ô)</span>
                    <span class="text-lg md:text-3xl font-bold text-red-600 leading-tight mt-1">${drRes}</span>
                </div>

                <!-- Open Price -->
                <div class="bg-white rounded-lg border border-gray-200 p-2 md:p-4 flex flex-col justify-center shadow-sm relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-blue-400"></div>
                    <span class="text-[10px] md:text-xs text-gray-400 font-bold uppercase tracking-wide">Open Price</span>
                    <span class="text-lg md:text-3xl font-bold text-blue-600 leading-tight mt-1">${drPrice}</span>
                </div>

                <!-- Support -->
                <div class="bg-green-50 rounded-lg border border-green-100 p-2 md:p-4 flex flex-col justify-center shadow-sm">
                    <span class="text-[10px] md:text-xs text-green-400 font-bold uppercase tracking-wide">Support (‡∏£‡∏±‡∏ö)</span>
                    <span class="text-lg md:text-3xl font-bold text-green-600 leading-tight mt-1">${drSup}</span>
                </div>
            </div>`;
            
            // Telegram Button in Summary
            html += `<div class="flex justify-end mb-4 no-print">
                <button id="btn-send-tg" onclick="sendConfluenceToTelegram()" class="flex items-center gap-2 px-3 py-1.5 bg-sky-500 text-white text-sm font-bold rounded-lg shadow hover:bg-sky-600 transition-colors">
                    <span>‚úàÔ∏è ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Telegram</span>
                </button>
            </div>`;

            // --- TF Cards Grid ---
            html += `<div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">`;
            
            timeframes.forEach(tf => {
                const s1El = document.getElementById(`${tf}-sig`);
                const sig1 = s1El ? s1El.value : "";
                const w1El = document.getElementById(`${tf}-wick`);
                const wick1 = w1El ? w1El.value : "";
                const tp1_1El = document.getElementById(`${tf}-tp1-val`);
                const tp1_1 = tp1_1El ? tp1_1El.innerText : "";
                const tp2_1El = document.getElementById(`${tf}-tp2-val`);
                const tp2_1 = tp2_1El ? tp2_1El.innerText : null;
                const msg1El = document.getElementById(`${tf}-msg`);
                const msg1 = msg1El ? msg1El.innerHTML : "";

                const toggleEl = document.getElementById(`${tf}-toggle-2`);
                const toggle2 = toggleEl ? toggleEl.checked : false;
                let sig2 = "", wick2 = "", tp1_2 = "", tp2_2 = "", msg2 = "";
                if(toggle2) {
                    const s2El = document.getElementById(`${tf}-sig-2`);
                    sig2 = s2El ? s2El.value : "";
                    const w2El = document.getElementById(`${tf}-wick-2`);
                    wick2 = w2El ? w2El.value : "";
                    const tp1_2El = document.getElementById(`${tf}-tp1-val-2`);
                    tp1_2 = tp1_2El ? tp1_2El.innerText : "";
                    const tp2_2El = document.getElementById(`${tf}-tp2-val-2`);
                    tp2_2 = tp2_2El ? tp2_2El.innerText : "";
                    const msg2El = document.getElementById(`${tf}-msg-2`);
                    msg2 = msg2El ? msg2El.innerHTML : "";
                }

                // NEW: Get checkbox states for styling
                const isTp1Checked = document.getElementById(`${tf}-tp1-check`)?.checked;
                const isTp2Checked = document.getElementById(`${tf}-tp2-check`)?.checked;
                const isTp1Checked2 = document.getElementById(`${tf}-tp1-check-2`)?.checked;
                const isTp2Checked2 = document.getElementById(`${tf}-tp2-check-2`)?.checked;

                const lowEl = document.getElementById(`${tf}-low`);
                const low = lowEl ? lowEl.value : "";
                const highEl = document.getElementById(`${tf}-high`);
                const high = highEl ? highEl.value : "";
                const rangeDiff = (low && high && !isNaN(low) && !isNaN(high)) ? (parseFloat(high) - parseFloat(low)).toFixed(2) : null;

                let headerColor = "bg-gray-100 text-gray-700";
                if(tf === 'mn') headerColor = "bg-gradient-to-r from-indigo-50 to-indigo-100 text-indigo-800";
                if(tf === 'wk') headerColor = "bg-gradient-to-r from-purple-50 to-purple-100 text-purple-800";
                if(tf === 'd') headerColor = "bg-gradient-to-r from-emerald-50 to-emerald-100 text-emerald-800";
                if(tf === 'h4') headerColor = "bg-gradient-to-r from-amber-50 to-amber-100 text-amber-800";
                if(tf === 'h1') headerColor = "bg-gradient-to-r from-rose-50 to-rose-100 text-rose-800";

                if (sig1 || wick1 || (toggle2 && (sig2 || wick2)) || low || high) {
                    html += `
                    <div class="bg-white rounded-xl border border-gray-200 shadow-md flex flex-col hover:shadow-xl hover:-translate-y-1 transition-all duration-300 break-inside-avoid">
                        <div class="${headerColor} px-3 py-2 rounded-t-xl border-b border-gray-200 flex justify-between items-center">
                            <span class="font-bold text-sm uppercase drop-shadow-sm">${tf}</span>
                            ${(low && high) ? '<span class="text-[10px] bg-white/70 px-2 py-0.5 rounded-full shadow-sm text-gray-600">SW Mode</span>' : ''}
                        </div>
                        <div class="p-3 text-sm flex-1 flex flex-col gap-3">
                            <div class="relative">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="font-bold text-gray-400 text-[10px]">S1</span>
                                    ${getStatusBadge(msg1)}
                                </div>
                                <div class="text-center py-1">
                                    ${getTrendIcon(sig1)}
                                    ${wick1 ? `<div class="text-gray-800 font-mono font-bold text-lg mt-1 tracking-tight">${wick1}</div><div class="mt-1 text-[10px] text-green-700 bg-green-50 rounded-full px-2 py-0.5 inline-block border border-green-100 shadow-sm">‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≠‡∏ö: <span class="font-bold">${wick1}</span></div>` : ''}
                                </div>
                                ${(sig1 && wick1) ? `
                                <div class="mt-2 pt-2 border-t border-gray-100 space-y-1">
                                    <div class="flex justify-between items-center text-xs">
                                        <span class="text-gray-400 font-medium">TP1</span>
                                        <span class="flex items-center gap-1 text-sm ${isTp1Checked ? 'text-green-600 font-bold bg-green-50 px-1.5 rounded-full' : 'text-gray-700 font-bold'}">
                                            ${tp1_1} ${isTp1Checked ? '<span class="text-[8px]">‚úì</span>' : ''}
                                        </span>
                                    </div>
                                    ${tp2_1 ? `
                                    <div class="flex justify-between items-center text-xs">
                                        <span class="text-gray-400 font-medium">TP2</span>
                                        <span class="flex items-center gap-1 text-sm ${isTp2Checked ? 'text-green-600 font-bold bg-green-50 px-1.5 rounded-full' : 'text-gray-700 font-bold'}">
                                            ${tp2_1} ${isTp2Checked ? '<span class="text-[8px]">‚úì</span>' : ''}
                                        </span>
                                    </div>` : ''}
                                </div>` : ''}
                            </div>
                            ${(toggle2 && sig2) ? `
                            <div class="relative border-t border-dashed border-gray-300 pt-2">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="font-bold text-gray-400 text-[10px]">S2</span>
                                    ${getStatusBadge(msg2)}
                                </div>
                                <div class="text-center py-1">
                                    ${getTrendIcon(sig2)}
                                    ${wick2 ? `<div class="text-gray-800 font-mono font-bold text-lg mt-1 tracking-tight">${wick2}</div><div class="mt-1 text-[10px] text-green-700 bg-green-50 rounded-full px-2 py-0.5 inline-block border border-green-100 shadow-sm">‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≠‡∏ö: <span class="font-bold">${wick2}</span></div>` : ''}
                                </div>
                                <div class="mt-2 pt-2 border-t border-gray-100 space-y-1">
                                    <div class="flex justify-between items-center text-xs">
                                        <span class="text-gray-400 font-medium">TP1</span>
                                        <span class="flex items-center gap-1 text-sm ${isTp1Checked2 ? 'text-green-600 font-bold bg-green-50 px-1.5 rounded-full' : 'text-gray-700 font-bold'}">
                                            ${tp1_2} ${isTp1Checked2 ? '<span class="text-[8px]">‚úì</span>' : ''}
                                        </span>
                                    </div>
                                    <div class="flex justify-between items-center text-xs">
                                        <span class="text-gray-400 font-medium">TP2</span>
                                        <span class="flex items-center gap-1 text-sm ${isTp2Checked2 ? 'text-green-600 font-bold bg-green-50 px-1.5 rounded-full' : 'text-gray-700 font-bold'}">
                                            ${tp2_2} ${isTp2Checked2 ? '<span class="text-[8px]">‚úì</span>' : ''}
                                        </span>
                                    </div>
                                </div>
                            </div>` : ''}
                            ${(low || high) ? `<div class="mt-auto bg-gradient-to-br from-slate-50 to-white rounded-lg border border-slate-200 p-2 relative overflow-hidden group shadow-inner"><div class="flex justify-between items-center mb-1"><span class="text-[9px] font-bold text-red-400 uppercase tracking-wider">High</span><span class="font-mono text-xs font-bold text-slate-700">${high || '-'}</span></div><div class="relative h-2 w-full bg-slate-100 rounded-full my-1 flex items-center justify-center overflow-hidden shadow-inner"><div class="absolute inset-0 bg-gradient-to-r from-green-200 to-red-200 opacity-60"></div>${rangeDiff ? `<span class="relative z-10 text-[8px] font-bold text-slate-600 bg-white/90 px-2 py-0.5 rounded-full shadow-sm">Range: ${rangeDiff}</span>` : ''}</div><div class="flex justify-between items-center"><span class="text-[9px] font-bold text-green-500 uppercase tracking-wider">Low</span><span class="font-mono text-xs font-bold text-slate-700">${low || '-'}</span></div></div>` : ''}
                        </div>
                    </div>`;
                } else {
                    html += `<div class="bg-gray-50 rounded-xl border border-dashed border-gray-300 flex items-center justify-center p-4 min-h-[150px] opacity-60 hover:opacity-100 transition-opacity"><div class="text-center"><span class="block text-gray-300 font-bold uppercase text-lg">${tf}</span><span class="text-xs text-gray-400">No Data</span></div></div>`;
                }
            });
            html += `</div>`; 
            
            summaryDiv.innerHTML = html;
        }

    </script>
</head>
<body class="text-gray-700">

    <!-- Scroll To Top Button -->
    <button id="scrollTopBtn" onclick="scrollToTop()" class="bg-pastel-accent text-white shadow-lg hover:bg-green-600 no-print" title="‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal" onclick="if(event.target === this) closeModal('confirmModal')">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4 border-2 border-red-200">
            <h3 class="text-xl font-bold text-red-600 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            <p class="text-gray-600 mb-6">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Journal ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? <br><span class="text-xs text-red-500">*‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ</span></p>
            <div class="flex justify-end gap-3">
                <button onclick="closeModal('confirmModal')" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 shadow-sm hover:shadow">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="confirmClearAll()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 shadow-sm hover:shadow-md">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>
    </div>

    <!-- Telegram Settings Modal -->
    <div id="telegramModal" class="modal" onclick="if(event.target === this) closeModal('telegramModal')">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4 border border-sky-200">
            <h3 class="text-xl font-bold text-sky-600 mb-4 flex items-center gap-2">
                ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Telegram Alerts
            </h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Telegram Bot Token</label>
                    <input type="text" id="tg-bot-token" class="w-full p-2 border rounded text-sm font-mono bg-gray-50" placeholder="123456789:ABCdef...">
                    <p class="text-[10px] text-gray-400 mt-1">‡∏™‡∏£‡πâ‡∏≤‡∏á Bot ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà @BotFather</p>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Chat ID (‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏•‡∏∏‡πà‡∏°)</label>
                    <input type="text" id="tg-chat-id" class="w-full p-2 border rounded text-sm font-mono bg-gray-50" placeholder="-100xxxx (‡∏Å‡∏•‡∏∏‡πà‡∏°) ‡∏´‡∏£‡∏∑‡∏≠ 1234xxxx (‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß)">
                    <div class="text-[10px] text-gray-500 mt-1 bg-gray-50 p-2 rounded border border-gray-100">
                        <p class="font-bold mb-1">‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤ Chat ID:</p>
                        <ul class="list-disc pl-4 space-y-1">
                            <li><b>‡∏™‡πà‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß:</b> ‡∏ó‡∏±‡∏Å‡πÅ‡∏ä‡∏ó <b>@userinfobot</b> ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏≠‡∏≤‡πÄ‡∏•‡∏Ç Id ‡∏°‡∏≤‡πÉ‡∏™‡πà</li>
                            <li><b>‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥):</b> 
                                <ol class="list-decimal pl-4 mt-1 space-y-1">
                                    <li>‡πÄ‡∏ä‡∏¥‡∏ç‡∏ö‡∏≠‡∏ó <b>@MissRose_bot</b> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°</li>
                                    <li>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á <code>/id</code> ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°</li>
                                    <li>‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡πÄ‡∏•‡∏Ç Chat ID (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏ö‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô -100...)</li>
                                </ol>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="flex items-center gap-2 pt-2">
                    <input type="checkbox" id="tg-enable" class="tp-checkbox">
                    <label for="tg-enable" class="text-sm font-bold text-gray-700">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                </div>
            </div>
            <div class="flex justify-between mt-6 pt-4 border-t border-gray-100">
                <button id="btn-test-tg" onclick="testTelegramConnection()" class="px-3 py-2 bg-orange-500 text-white text-xs font-bold rounded hover:bg-orange-600 shadow-sm transition-colors flex items-center gap-1">
                    üîî ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Test)
                </button>
                <div class="flex gap-2">
                    <button onclick="closeModal('telegramModal')" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">‡∏õ‡∏¥‡∏î</button>
                    <button onclick="saveTelegramSettings()" class="px-4 py-2 bg-sky-500 text-white rounded hover:bg-sky-600 shadow-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Print Output -->
    <div id="print-output"></div>

    <div class="print-container max-w-4xl mx-auto p-4 md:p-6 bg-white shadow-2xl min-h-screen my-4 rounded-2xl border border-white">
        
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-6 pb-4 border-b border-gray-100 no-print">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-pastel-text drop-shadow-sm">Trading Journal Pro</h1>
                <p class="text-sm text-gray-500 mt-1" id="status-indicator">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</p>
            </div>
            <div class="mt-4 md:mt-0 flex gap-2 flex-wrap justify-center items-center">
                <button onclick="saveData()" class="px-4 py-2 bg-pastel-accent text-white font-bold rounded-lg shadow-md hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 transition-all duration-200">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Cloud</button>
                <button onclick="printSummary()" class="px-4 py-2 bg-purple-500 text-white font-bold rounded-lg shadow-md hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 transition-all duration-200 hover:bg-purple-600">‡∏û‡∏¥‡∏°‡∏û‡πå(‡∏™‡∏£‡∏∏‡∏õ) PDF</button>
                <button onclick="openModal('confirmModal')" class="px-4 py-2 bg-red-500 text-white font-bold rounded-lg shadow-md hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 transition-all duration-200 hover:bg-red-600">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                
                <!-- Telegram Settings Button -->
                <button onclick="openModal('telegramModal')" class="p-2 ml-2 text-gray-400 hover:text-sky-500 hover:bg-sky-50 rounded-full transition-colors" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Telegram">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Form -->
        <div class="main-form-section space-y-8">
            
            <!-- Daily Plan -->
            <section class="bg-pastel-bg p-6 rounded-2xl border border-pastel-header shadow-md hover:shadow-lg transition-shadow duration-300">
                <h2 class="text-xl font-bold text-pastel-text mb-4 flex items-center gap-2">
                    <span class="bg-white p-1 rounded-md shadow-sm">üìÖ</span> ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô
                </h2>
                <div class="flex flex-col md:flex-row gap-4 items-end mb-4">
                    <div class="w-full md:w-auto flex-1">
                        <label class="block text-sm font-semibold mb-1 text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <div class="flex gap-2">
                            <input type="text" id="date" class="w-full p-2.5 rounded-lg border-gray-300" placeholder="‡∏ß‡∏ß/‡∏î‡∏î/‡∏õ‡∏õ‡∏õ‡∏õ">
                            <button onclick="setDate()" class="px-4 py-2.5 bg-blue-500 text-white rounded-lg shadow-md hover:bg-blue-600 text-sm whitespace-nowrap transition-colors">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-semibold mb-1 text-gray-700">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡∏ß‡∏±‡∏ô (07.00 ‡∏ô.)</label>
                        <input type="number" step="0.01" id="dr-price" class="w-full p-2.5 rounded-lg border-gray-300" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤">
                    </div>
                    <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-sm flex flex-col justify-center">
                        <span class="block text-xs text-gray-500 font-semibold uppercase">‡πÅ‡∏ô‡∏ß‡∏ï‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å (+5)</span>
                        <span id="dr-res" class="text-xl font-bold text-red-500">...</span>
                    </div>
                    <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-sm flex flex-col justify-center">
                        <span class="block text-xs text-gray-500 font-semibold uppercase">‡πÅ‡∏ô‡∏ß‡∏ï‡πâ‡∏≤‡∏ô‡∏£‡∏±‡∏ö (-5)</span>
                        <span id="dr-sup" class="text-xl font-bold text-green-500">...</span>
                    </div>
                </div>
            </section>

            <!-- Main Timeframes Analysis -->
            <section class="space-y-6">
                <h2 class="text-2xl font-bold text-pastel-text border-l-4 border-pastel-accent pl-4 py-1">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏£‡∏≤‡∏ü‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h2>
                
                <!-- Timeframe Blocks (MN, WK, D, H4, H1) -->
                <!-- MONTH -->
                <div class="bg-gradient-to-br from-indigo-50 to-white p-5 rounded-2xl border border-indigo-100 shadow-md hover:shadow-xl transition-all duration-300 relative group">
                    <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-indigo-700 flex items-center gap-2"><span class="bg-indigo-100 p-1 rounded text-sm">üìÖ</span> MONTH (MN)</h3><div class="flex gap-3 items-center"><label class="flex items-center cursor-pointer text-sm select-none bg-white px-2 py-1 rounded-full shadow-sm border border-gray-100"><span class="mr-2 font-medium text-gray-600 text-xs">Setup 2</span><div class="relative"><input type="checkbox" id="mn-toggle-2" class="sr-only peer"><div class="w-8 h-4 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-pastel-toggle_on"></div></div></label><button onclick="clearSection('mn')" class="text-xs text-red-400 hover:text-red-600 underline decoration-dotted">CLEAR MN</button></div></div><div id="mn-setup-1"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sig Buy/Sell</label><select id="mn-sig" class="w-full p-2.5 rounded-lg border-gray-200"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option><option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option><option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option></select></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig MN</label><input type="number" step="0.01" id="mn-wick" class="w-full p-2.5 rounded-lg border-gray-200" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"></div><div class="col-span-1 md:col-span-2 grid grid-cols-2 gap-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sideway Low</label><input type="number" step="0.01" id="mn-low" class="w-full p-2.5 rounded-lg border-gray-200"></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sideway High</label><input type="number" step="0.01" id="mn-high" class="w-full p-2.5 rounded-lg border-gray-200"></div></div></div><div class="space-y-3"><div id="mn-tp1-box" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP1 MN (+/- 500) : <span id="mn-tp1-val" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="mn-tp1-check">Check</label><input type="checkbox" id="mn-tp1-check" class="tp-checkbox"></div></div><div id="mn-tp2-box" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP2 MN (+/- 1000) : <span id="mn-tp2-val" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="mn-tp2-check">Check</label><input type="checkbox" id="mn-tp2-check" class="tp-checkbox"></div></div></div><div id="mn-msg" class="min-h-[1.5rem] mt-2"></div></div><div id="mn-setup-2" class="hidden mt-6 pt-4 border-t-2 border-dashed border-indigo-100 relative"><div class="absolute -top-3 left-4 bg-indigo-50 px-2 text-xs font-bold text-indigo-400">Setup 2</div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sig Buy/Sell (2)</label><select id="mn-sig-2" class="w-full p-2.5 rounded-lg border-gray-200"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option><option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option><option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option></select></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig (2)</label><input type="number" step="0.01" id="mn-wick-2" class="w-full p-2.5 rounded-lg border-gray-200" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"></div></div><div class="space-y-3"><div id="mn-tp1-box-2" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP1 (+/- 500) : <span id="mn-tp1-val-2" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="mn-tp1-check-2">Check</label><input type="checkbox" id="mn-tp1-check-2" class="tp-checkbox"></div></div><div id="mn-tp2-box-2" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP2 (+/- 1000) : <span id="mn-tp2-val-2" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="mn-tp2-check-2">Check</label><input type="checkbox" id="mn-tp2-check-2" class="tp-checkbox"></div></div></div><div id="mn-msg-2" class="min-h-[1.5rem] mt-2"></div></div>
                </div>

                <!-- WEEK -->
                <div class="bg-gradient-to-br from-purple-50 to-white p-5 rounded-2xl border border-purple-100 shadow-md hover:shadow-xl transition-all duration-300 relative group">
                    <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-purple-700 flex items-center gap-2"><span class="bg-purple-100 p-1 rounded text-sm">üìÖ</span> WEEK (WK)</h3><div class="flex gap-3 items-center"><label class="flex items-center cursor-pointer text-sm select-none bg-white px-2 py-1 rounded-full shadow-sm border border-gray-100"><span class="mr-2 font-medium text-gray-600 text-xs">Setup 2</span><div class="relative"><input type="checkbox" id="wk-toggle-2" class="sr-only peer"><div class="w-8 h-4 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-pastel-toggle_on"></div></div></label><button onclick="clearSection('wk')" class="text-xs text-red-400 hover:text-red-600 underline decoration-dotted">CLEAR WK</button></div></div><div id="wk-setup-1"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sig Buy/Sell</label><select id="wk-sig" class="w-full p-2.5 rounded-lg border-gray-200"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option><option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option><option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option></select></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig WK</label><input type="number" step="0.01" id="wk-wick" class="w-full p-2.5 rounded-lg border-gray-200" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"></div><div class="col-span-1 md:col-span-2 grid grid-cols-2 gap-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sideway Low</label><input type="number" step="0.01" id="wk-low" class="w-full p-2.5 rounded-lg border-gray-200"></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sideway High</label><input type="number" step="0.01" id="wk-high" class="w-full p-2.5 rounded-lg border-gray-200"></div></div></div><div class="space-y-3"><div id="wk-tp1-box" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP1 WK (+/- 150) : <span id="wk-tp1-val" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="wk-tp1-check">Check</label><input type="checkbox" id="wk-tp1-check" class="tp-checkbox"></div></div><div id="wk-tp2-box" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP2 WK (+/- 300) : <span id="wk-tp2-val" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="wk-tp2-check">Check</label><input type="checkbox" id="wk-tp2-check" class="tp-checkbox"></div></div></div><div id="wk-msg" class="min-h-[1.5rem] mt-2"></div></div><div id="wk-setup-2" class="hidden mt-6 pt-4 border-t-2 border-dashed border-purple-100 relative"><div class="absolute -top-3 left-4 bg-purple-50 px-2 text-xs font-bold text-purple-400">Setup 2</div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sig Buy/Sell (2)</label><select id="wk-sig-2" class="w-full p-2.5 rounded-lg border-gray-200"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option><option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option><option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option></select></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig (2)</label><input type="number" step="0.01" id="wk-wick-2" class="w-full p-2.5 rounded-lg border-gray-200" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"></div></div><div class="space-y-3"><div id="wk-tp1-box-2" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP1 (+/- 150) : <span id="wk-tp1-val-2" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="wk-tp1-check-2">Check</label><input type="checkbox" id="wk-tp1-check-2" class="tp-checkbox"></div></div><div id="wk-tp2-box-2" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP2 (+/- 300) : <span id="wk-tp2-val-2" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="wk-tp2-check-2">Check</label><input type="checkbox" id="wk-tp2-check-2" class="tp-checkbox"></div></div></div><div id="wk-msg-2" class="min-h-[1.5rem] mt-2"></div></div>
                </div>

                <!-- DAY -->
                <div class="bg-gradient-to-br from-emerald-50 to-white p-5 rounded-2xl border border-emerald-100 shadow-md hover:shadow-xl transition-all duration-300 relative group">
                    <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-emerald-700 flex items-center gap-2"><span class="bg-emerald-100 p-1 rounded text-sm">üìÖ</span> DAY (D)</h3><div class="flex gap-3 items-center"><label class="flex items-center cursor-pointer text-sm select-none bg-white px-2 py-1 rounded-full shadow-sm border border-gray-100"><span class="mr-2 font-medium text-gray-600 text-xs">Setup 2</span><div class="relative"><input type="checkbox" id="d-toggle-2" class="sr-only peer"><div class="w-8 h-4 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-pastel-toggle_on"></div></div></label><button onclick="clearSection('d')" class="text-xs text-red-400 hover:text-red-600 underline decoration-dotted">CLEAR DAY</button></div></div><div id="d-setup-1"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sig Buy/Sell</label><select id="d-sig" class="w-full p-2.5 rounded-lg border-gray-200"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option><option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option><option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option></select></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig Day</label><input type="number" step="0.01" id="d-wick" class="w-full p-2.5 rounded-lg border-gray-200" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"></div><div class="col-span-1 md:col-span-2 grid grid-cols-2 gap-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sideway Low</label><input type="number" step="0.01" id="d-low" class="w-full p-2.5 rounded-lg border-gray-200"></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sideway High</label><input type="number" step="0.01" id="d-high" class="w-full p-2.5 rounded-lg border-gray-200"></div></div></div><div class="space-y-3"><div id="d-tp1-box" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP1 Day (+/- 50) : <span id="d-tp1-val" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="d-tp1-check">Check</label><input type="checkbox" id="d-tp1-check" class="tp-checkbox"></div></div><div id="d-tp2-box" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP2 Day (+/- 100) : <span id="d-tp2-val" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="d-tp2-check">Check</label><input type="checkbox" id="d-tp2-check" class="tp-checkbox"></div></div></div><div id="d-msg" class="min-h-[1.5rem] mt-2"></div></div><div id="d-setup-2" class="hidden mt-6 pt-4 border-t-2 border-dashed border-emerald-100 relative"><div class="absolute -top-3 left-4 bg-emerald-50 px-2 text-xs font-bold text-emerald-400">Setup 2</div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sig Buy/Sell (2)</label><select id="d-sig-2" class="w-full p-2.5 rounded-lg border-gray-200"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option><option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option><option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option></select></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig (2)</label><input type="number" step="0.01" id="d-wick-2" class="w-full p-2.5 rounded-lg border-gray-200" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"></div></div><div class="space-y-3"><div id="d-tp1-box-2" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP1 (+/- 50) : <span id="d-tp1-val-2" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="d-tp1-check-2">Check</label><input type="checkbox" id="d-tp1-check-2" class="tp-checkbox"></div></div><div id="d-tp2-box-2" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP2 (+/- 100) : <span id="d-tp2-val-2" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="d-tp2-check-2">Check</label><input type="checkbox" id="d-tp2-check-2" class="tp-checkbox"></div></div></div><div id="d-msg-2" class="min-h-[1.5rem] mt-2"></div></div>
                </div>

                <!-- H4 -->
                <div class="bg-gradient-to-br from-amber-50 to-white p-5 rounded-2xl border border-amber-100 shadow-md hover:shadow-xl transition-all duration-300 relative group">
                    <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-amber-700 flex items-center gap-2"><span class="bg-amber-100 p-1 rounded text-sm">üìÖ</span> H4</h3><div class="flex gap-3 items-center"><label class="flex items-center cursor-pointer text-sm select-none bg-white px-2 py-1 rounded-full shadow-sm border border-gray-100"><span class="mr-2 font-medium text-gray-600 text-xs">Setup 2</span><div class="relative"><input type="checkbox" id="h4-toggle-2" class="sr-only peer"><div class="w-8 h-4 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-pastel-toggle_on"></div></div></label><button onclick="clearSection('h4')" class="text-xs text-red-400 hover:text-red-600 underline decoration-dotted">CLEAR H4</button></div></div><div id="h4-setup-1"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sig Buy/Sell</label><select id="h4-sig" class="w-full p-2.5 rounded-lg border-gray-200"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option><option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option><option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option></select></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig H4</label><input type="number" step="0.01" id="h4-wick" class="w-full p-2.5 rounded-lg border-gray-200" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"></div><div class="col-span-1 md:col-span-2 grid grid-cols-2 gap-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sideway Low</label><input type="number" step="0.01" id="h4-low" class="w-full p-2.5 rounded-lg border-gray-200"></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sideway High</label><input type="number" step="0.01" id="h4-high" class="w-full p-2.5 rounded-lg border-gray-200"></div></div></div><div class="space-y-3"><div id="h4-tp1-box" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP1 H4 (+/- 15) : <span id="h4-tp1-val" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="h4-tp1-check">Check</label><input type="checkbox" id="h4-tp1-check" class="tp-checkbox"></div></div><div id="h4-tp2-box" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP2 H4 (+/- 30) : <span id="h4-tp2-val" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="h4-tp2-check">Check</label><input type="checkbox" id="h4-tp2-check" class="tp-checkbox"></div></div></div><div id="h4-msg" class="min-h-[1.5rem] mt-2"></div></div><div id="h4-setup-2" class="hidden mt-6 pt-4 border-t-2 border-dashed border-amber-100 relative"><div class="absolute -top-3 left-4 bg-amber-50 px-2 text-xs font-bold text-amber-400">Setup 2</div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sig Buy/Sell (2)</label><select id="h4-sig-2" class="w-full p-2.5 rounded-lg border-gray-200"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option><option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option><option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option></select></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig (2)</label><input type="number" step="0.01" id="h4-wick-2" class="w-full p-2.5 rounded-lg border-gray-200" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"></div></div><div class="space-y-3"><div id="h4-tp1-box-2" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP1 (+/- 15) : <span id="h4-tp1-val-2" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="h4-tp1-check-2">Check</label><input type="checkbox" id="h4-tp1-check-2" class="tp-checkbox"></div></div><div id="h4-tp2-box-2" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP2 (+/- 30) : <span id="h4-tp2-val-2" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="h4-tp2-check-2">Check</label><input type="checkbox" id="h4-tp2-check-2" class="tp-checkbox"></div></div></div><div id="h4-msg-2" class="min-h-[1.5rem] mt-2"></div></div>
                </div>

                <!-- H1 -->
                <div class="bg-gradient-to-br from-rose-50 to-white p-5 rounded-2xl border border-rose-100 shadow-md hover:shadow-xl transition-all duration-300 relative group">
                    <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-rose-700 flex items-center gap-2"><span class="bg-rose-100 p-1 rounded text-sm">üìÖ</span> H1</h3><div class="flex gap-3 items-center"><button onclick="clearSection('h1')" class="text-xs text-red-400 hover:text-red-600 underline decoration-dotted">CLEAR H1</button></div></div><div id="h1-setup-1"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sig Buy/Sell (6 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</label><select id="h1-sig" class="w-full p-2.5 rounded-lg border-gray-200"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option><option value="Buy P1">Buy P1</option><option value="Buy P2">Buy P2</option><option value="Buy P3">Buy P3</option><option value="Sell P1">Sell P1</option><option value="Sell P2">Sell P2</option><option value="Sell P3">Sell P3</option></select></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">‡πÑ‡∏™‡πâ‡∏´‡∏•‡∏±‡∏á Sig H1</label><input type="number" step="0.01" id="h1-wick" class="w-full p-2.5 rounded-lg border-gray-200" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"></div><div class="col-span-1 md:col-span-2 grid grid-cols-2 gap-4"><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sideway Low</label><input type="number" step="0.01" id="h1-low" class="w-full p-2.5 rounded-lg border-gray-200"></div><div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Sideway High</label><input type="number" step="0.01" id="h1-high" class="w-full p-2.5 rounded-lg border-gray-200"></div></div></div><div class="space-y-3"><div id="h1-tp1-box" class="tp-box border border-gray-200 rounded-lg p-3 flex items-center justify-between shadow-sm"><span class="font-semibold text-sm">TP1 H1 (+/- 10) : <span id="h1-tp1-val" class="font-mono">...</span></span><div class="flex items-center gap-2"><label class="text-xs font-bold uppercase text-gray-400 cursor-pointer" for="h1-tp1-check">Check</label><input type="checkbox" id="h1-tp1-check" class="tp-checkbox"></div></div></div><div id="h1-msg" class="min-h-[1.5rem] mt-2"></div></div>
                </div>

                <!-- Daily Notes -->
                <div class="bg-white p-6 rounded-2xl border border-pastel-header shadow-md hover:shadow-lg transition-shadow duration-300">
                    <label class="block font-bold text-pastel-text mb-2 flex items-center gap-2">
                        <span class="bg-green-50 p-1 rounded-md">üìù</span> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                    </label>
                    <textarea id="daily-note" class="w-full h-24 p-3 rounded-lg border-gray-200 focus:border-green-400 focus:ring-2 focus:ring-green-100 transition-all" placeholder="‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..."></textarea>
                </div>

            </section>
            
            <!-- Summary Footer -->
            <section id="summary-section" class="summary-section bg-white p-8 rounded-2xl border border-white shadow-2xl mt-8 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-green-400 to-blue-500"></div>
                <h2 class="text-2xl font-bold text-center text-gray-800 mb-6 pb-4 border-b border-gray-100">‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° Trading Journal</h2>
                <div id="summary-content">Loading...</div>
                <!-- Hidden Note Container for Print Only -->
                <div id="print-daily-note" class="hidden mt-4 pt-4 border-t border-gray-300"></div>
                
                <!-- NEW SECTION: Live Monitor -->
                <div id="live-monitor-section" class="mt-8 bg-gray-900 text-white p-4 rounded-xl shadow-lg relative overflow-hidden border border-gray-700 no-print">
                    <div class="absolute top-0 right-0 p-2 opacity-5 pointer-events-none">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                        </svg>
                    </div>

                    <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-4 mb-4">
                        <!-- Title & Indicator -->
                        <div class="flex items-center gap-3">
                            <div class="relative flex h-3 w-3">
                              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                              <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                            </div>
                            <h2 class="text-lg font-bold text-green-400">Live Gold Monitor</h2>
                        </div>
                        
                        <!-- Controls Container (Horizontal Layout) -->
                        <div class="flex flex-wrap items-center gap-3 w-full md:w-auto justify-center md:justify-end">
                            <div class="flex items-center bg-gray-800 rounded-lg p-1 border border-gray-700">
                                <div class="px-3 border-r border-gray-600">
                                    <span class="text-[9px] text-gray-400 block uppercase">Binance</span>
                                    <span id="binance-price-display" class="font-mono font-bold text-sm text-white">---</span>
                                </div>
                                <div class="px-2 flex items-center gap-2">
                                    <span class="text-[9px] text-gray-400 uppercase">Diff</span>
                                    <input type="number" id="broker-diff" step="0.01" class="bg-gray-700 text-yellow-400 font-bold border-none rounded p-1 w-16 text-right font-mono focus:ring-1 focus:ring-green-500 text-sm" placeholder="0.00" value="0.00">
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-gray-800 to-gray-700 px-4 py-1.5 rounded-lg border border-green-900 shadow-inner flex items-center gap-3">
                                <div class="text-right">
                                    <span class="text-[9px] text-green-400 block uppercase font-bold tracking-wider">Broker Price</span>
                                    <span id="broker-price-display" class="text-xl font-mono font-bold text-white tracking-tight leading-none">0.00</span>
                                </div>
                                <span class="live-dot mt-1" title="Real-time Active"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Intelligence Dashboard (Confluence & Alerts) -->
                    <div id="intelligence-dashboard-container" class="bg-gray-100 rounded-lg p-3 text-gray-800">
                        <div id="intelligence-dashboard-content">
                            <p class="text-gray-400 text-xs italic text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</p>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </div>

</body>
</html>
